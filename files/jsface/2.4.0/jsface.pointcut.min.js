/*
 * JSFace Object Oriented Programming Library - Plug and Play pointcut plugin
 * https://github.com/tnhu/jsface
 *
 * Copyright (c) Tan Nhu
 * Licensed under MIT license (https://github.com/tnhu/jsface/blob/master/LICENSE.txt).
 */
(function(k){function p(a,d,e,f){function b(){for(var a=b.___before_fns___,f=a.length,h=b.___after_fns___,d=h.length,e=b.___origin_fn___,l;f--;)if(l=a[f].apply(this,arguments),m(l)&&!0===l.$skip)return l.$data;for(a=e.apply(this,arguments);d--&&(l=h[d].apply(this,arguments),!m(l)||!0!==l.$skip););return a}if(a.___wrapper___===a)return a.___before_fns___.push(d),a.___after_fns___.push(e),a.___advisors___.push(f),a;t(b,a,0,!0);q(a)&&(b.prototype=a.prototype);b.___before_fns___=[d];b.___after_fns___=[e];b.___origin_fn___=a;b.___advisors___=[f];b.___wrapper___=b;b.$super=a.$super;b.$superp=a.$superp;return b}function n(a,d){var e,f,b;if(a&&a===a.___wrapper___)if(d){for(f=b=a.___advisors___.length;f--&&a.___advisors___[f]!==d;);if(0<=f){if(1===b)return n(a);a.___advisors___.splice(f,1);a.___before_fns___.splice(f,1);a.___after_fns___.splice(f,1)}}else e=a.___origin_fn___,delete a.___origin_fn___,delete a.___advisors___,delete a.___before_fns___,delete a.___after_fns___,delete a.___wrapper___;return e}function u(a,d,e,f,b,c){function k(d,e){var b,g;for(b in d)g=b/1==b?d[b]:b,"constructor"===g&&f?h=n(f,e):(a[g]&&(a[g]=n(a[g],e)),c[g]&&(c[g]=n(c[g],e)))}var h;if("remove"===d)if(e)k(e,e);else{h=f&&a===a.___wrapper___&&a.___origin_fn___;for(var g in c)c[g]=n(c[g])||c[g];for(g in a)a[g]=n(a[g])||a[g]}else if(null!==(e=/^remove /.exec(d)))d=d.replace(e,"").split(" "),k(d);else throw"Invalid params";return h||a}k=k.jsface||require("./jsface");var q=k.classOrNil,g=k.functionOrNil,t=k.extend,m=k.mapOrNil,r=function(){};k.pointcut=function(a,d,e){var f=q(a)||g(a),b=m(a),c=null!==/^remove ?/.exec(d),k=c&&e,h;if(!f&&!b||!m(d)&&!c)throw"Invalid params";e=f?a.prototype:a;if(c)return u(a,d,k,f,b,e);for(h in d){c=d[h];c=g(c)?{before:c}:c;f=m(c)&&!c.before?r:c.before;c=m(c)&&!c.after?r:c.after;k=!1;if(!g(f))throw"Invalid "+h+":before";if(!g(c))throw"Invalid "+h+":after";if(b)if(g(e[h]))e[h]=p(e[h],f,c,d);else throw"Non-function property named "+h+" on instance";else if("constructor"===h)a=p(a,f,c,d);else if(g(a[h])&&(a[h]=p(a[h],f,c,d),k=!0),g(e[h])&&(e[h]=p(e[h],f,c,d),k=!0),!k)throw"Non-function property named "+h+" on class";}return a};"undefined"!==typeof module&&module.exports&&(module.exports=k.pointcut)})(this);