/**
* @author Jason Dobry <jason.dobry@gmail.com>
* @file js-data-schema.min.js
* @version 1.0.0 - Homepage <https://github.com/js-data/js-data-schema/>
* @copyright (c) 2013-2014 Jason Dobry <https://github.io/js-data/js-data-schema>
* @license MIT <https://github.com/js-data/js-data-schema/blob/master/LICENSE>
*
* @overview Define and validate rules, datatypes and schemata in Node and in the browser.
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Schemator=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("./utils");b.exports={string:function(a){return c.isString(a)?null:c.errMsg("type",typeof a,"string")},number:function(a){return c.isNumber(a)?null:c.errMsg("type",typeof a,"number")},integer:function(a){return c.isNumber(a)?Math.abs(a)-Math.abs(c.toInt(a))!==0?c.errMsg("type","real","integer"):null:c.errMsg("type",typeof a,"integer")},"float":function(a){return c.isNumber(a)?null:c.errMsg("type",typeof a,"float")},array:function(a){return c.isArray(a)?null:c.errMsg("type",typeof a,"array")},object:function(a){return c.isObject(a)?null:c.errMsg("type",typeof a,"object")},"boolean":function(a){return c.isBoolean(a)?null:c.errMsg("type",typeof a,"boolean")},date:function(a){return c.isDate(a)?null:c.errMsg("type",typeof a,"date")}}},{"./utils":5}],2:[function(a,b){"use strict";function c(){this.dataTypes={},this.rules={},this.schemata={},this.id=h++}var d=a("./utils"),e=a("./dataTypes"),f=a("./rules"),g=a("./schema"),h=1,i=c.prototype;i.availableDataTypes=function(){return d.unique(d.keys(this.dataTypes).concat(d.keys(e)))},i.availableRules=function(){return d.unique(d.keys(this.rules).concat(d.keys(f)))},i.availableSchemata=function(){return d.keys(this.schemata)},i.defineDataType=function(a,b){if(!d.isString(a))throw new Error('"name" must be a string!');if(!d.isFunction(b))throw new Error('"typeDefinition" must be a function!');if(this.dataTypes[a])throw new Error("dataType already registered!");this.dataTypes[a]=b},i.defineRule=function(a,b,c){if(!d.isString(a))throw new Error('"name" must be a string!');if(!d.isFunction(b))throw new Error('"ruleFunc" must be a function!');if(this.rules[a])throw new Error("rule already registered!");this.rules[a]=b,this.rules[a].async=!!c},i.defineSchema=function(a,b){if(this.schemata[a])throw new Error("schema already registered!");if(b instanceof g)throw new Error("schema registered elsewhere!");return this.schemata[a]=new g(a,b,this),this.schemata[a].parent=this,this.schemata[a]},i.getDataType=function(a){return this.dataTypes[a]||e[a]},i.getRule=function(a){return this.rules[a]||f[a]},i.getSchema=function(a){return this.schemata[a]},i.removeDataType=function(a){delete this.dataTypes[a]},i.removeRule=function(a){delete this.rules[a]},i.removeSchema=function(a){delete this.schemata[a]},d.forOwn(g.prototype,function(a,b){"function"==typeof a&&(i[b]=function(b){if(!this.schemata[b])throw new Error("schema is not registered!");var c=Array.prototype.slice.call(arguments);return c.shift(),a.apply(this.schemata[b],c)})}),b.exports=c},{"./dataTypes":1,"./rules":3,"./schema":4,"./utils":5}],3:[function(a,b){"use strict";var c=a("./utils"),d=a("./dataTypes");b.exports={nullable:function(a,b){return null!==a&&void 0!==a||b?null:c.errMsg("nullable","x === "+a,"x !== null && x !== undefined")},max:function(a,b){return c.isNumber(a)&&c.isNumber(b)&&a>b?c.errMsg("max",""+a+" > "+b,""+a+" <= "+b):null},min:function(a,b){return c.isNumber(a)&&c.isNumber(b)&&b>a?c.errMsg("min",""+a+" < "+b,""+a+" >= "+b):null},maxLength:function(a,b){return(c.isString(a)||c.isArray(a))&&c.isNumber(b)&&a.length>b?c.errMsg("maxLength",""+a.length+" > "+b,""+a.length+" <= "+b):null},minLength:function(a,b){return(c.isString(a)||c.isArray(a))&&c.isNumber(b)&&a.length<b?c.errMsg("minLength",""+a.length+" < "+b,""+a.length+" >= "+b):null},type:function(a,b,c){return c?c(a):d[b]?d[b](a):null}}},{"./dataTypes":1,"./utils":5}],4:[function(a,b){"use strict";function c(a,b,c,e,f){var g=this,h=a+(a.length?".":"")+f;if(j.isObject(e)){var i=d.apply(g,[h,e,b]);i&&(c[f]=i)}else{var l=j.get(g.schema,h);if(!j.isObject(l))return;if(l.nullable===!0){var m=this.parent.rules.nullable||k.nullable,n=m(e,!0);if(null===n)return}j.forOwn(l,function(a,b){var d=g.parent.rules[b]||k[b];if(!d.async){var h=d(e,a);h&&(c[f]||(c[f]={errors:[]}),c[f].errors.push(h))}})}}function d(a,b,d){var e={},f=this;try{if(j.forOwn(b,function(b,g){c.call(f,a,d,e,b,g)}),!d.ignoreMissing){var g=a?j.get(f.schema,a)||{}:f.schema,h=j.difference(j.keys(g),j.keys(b));h=j.pick(this.schema,h),h=j.map(h,function(){return void 0}),j.forOwn(h,function(b,g){c.call(f,a,d,e,b,g)})}return j.isEmpty(e)?null:e}catch(i){return i}}function e(a,b,c,d,e,g,h){var i=this,l=d+c;if(j.isObject(b))g[c]=function(b,c){return function(d){f.apply(i,[b,c,a,d])}}(l,b);else{var m=j.get(i.schema,l);if(!j.isObject(m))return;if(m.nullable===!0){var n=this.parent.rules.nullable||k.nullable,o=n(b,!0);if(null===o)return}j.forOwn(m,function(a,d){var f=i.parent.rules[d]||k[d];if(f.async)h[d]=function(a,b,c,d){return function(e){a(c,d,function(a){e(null,{err:a,key:b})})}}(f,c,b,a);else{var g=f(b,a);g&&(e[c]||(e[c]={errors:[]}),e[c].errors.push(g))}})}}function f(a,b,c,d){var f={},g=this,h=a+(a.length?".":""),i={},k={},l=c.first;if(delete c.first,j.forOwn(b,function(a,b){e.call(g,c,a,b,h,f,i,k)}),!c.ignoreMissing){var m=a?j.get(g.schema,a)||{}:g.schema,n=j.difference(j.keys(m),j.keys(b));n=j.pick(this.schema,n),n=j.map(n,function(){return void 0}),j.forOwn(n,function(a,b){e.call(g,c,a,b,h,f,i,k)})}var o={};j.isEmpty(i)||(o.deepQueue=function(a){j.parallel(i,a)}),j.isEmpty(k)||(o.ruleQueue=function(a){j.parallel(k,a)}),j.isEmpty(o)?j.isEmpty(f)?d(null):l?d(f):d(null,f):j.parallel(o,function(a,b){b.deepQueue&&(b.deepQueue=j.filter(b.deepQueue,function(a){return void 0!==a&&null!==a}),j.deepMixIn(f,b.deepQueue)),b.ruleQueue&&(b.ruleQueue&&(b.ruleQueue=j.filter(b.ruleQueue,function(a){return void 0!==a.err&&null!==a.err})),j.forOwn(b.ruleQueue,function(a){f[a.key]||(f[a.key]={errors:[]}),f[a.key].errors.push(a.err)})),j.isEmpty(f)?d(null):l?d(f):d(null,f)})}function g(a,b){b=b||[];var c=j.keys(a),d=0===j.intersection(c,b).length;j.forOwn(a,function(c,e){if(d&&j.isString(c))a[e]={type:c};else if(j.isObject(c)){if(j.contains(b,e))throw new Error('Rule configuration for rule "'+e+'" cannot be an object!');g(c,b)}})}function h(a,b,c){if(!j.isString(a))throw new Error('"name" must be a string!');if(!j.isObject(b))throw new Error('"schema" must be an object!');this.name=a,g(b,c?c.availableRules():k),this.schema=b}function i(a,b){j.forOwn(a,function(c,d){b[d]?j.isObject(c)&&j.isObject(b[d])&&i(c,b[d]):j.unset(a,d)})}var j=a("./utils"),k=a("./rules"),l=h.prototype;l.validateSync=function(a,b){if(b=b?b===!0?{ignoreMissing:!0}:b:{},!j.isObject(a))throw new Error("Schema#validateSync(attrs[, options]): attrs: Must be an object!");if(!j.isObject(b))throw new Error("Schema#validateSync(attrs[, options]): options: Must be an object!");return d.apply(this,["",a,b])},l.validate=function(a,b,c){if(b=b?b===!0?{ignoreMissing:!0}:b:{},j.isFunction(b)&&(c=b,b={}),!j.isFunction(c))throw new Error("Schema#validate(attrs[, options], cb): cb: Must be a function!");return j.isObject(a)?j.isObject(b)?(b.first=!0,void f.apply(this,["",a,b,c])):c(new Error("Schema#validate(attrs[, options], cb): options: Must be an object!")):c(new Error("Schema#validate(attrs[, options], cb): attrs: Must be an object!"))},l.addDefaultsToTarget=function(a,b){if(!j.isObject(a))throw new Error('"target" must be an object!');if(!this.defaults)throw new Error("No defaults have been set!");b?j.deepMixIn(a,this.defaults):j.deepFillIn(a,this.defaults)},l.setDefaults=function(a){if(!j.isObject(a))throw new Error("Schema#defaults(attrs): attrs: Must be an object!");return this.defaults=j.merge({},a),this},l.getDefaults=function(){return j.merge({},this.defaults)},l.stripNonSchemaAttrs=function(a){return i(a,this.schema),a},b.exports=h},{"./rules":3,"./utils":5}],5:[function(a,b){"use strict";b.exports={isString:a("mout/lang/isString"),isBoolean:a("mout/lang/isBoolean"),isNumber:a("mout/lang/isNumber"),isObject:a("mout/lang/isObject"),isDate:a("mout/lang/isDate"),isFunction:a("mout/lang/isFunction"),isUndefined:a("mout/lang/isUndefined"),isArray:a("mout/lang/isArray"),isEmpty:a("mout/lang/isEmpty"),toString:a("mout/lang/toString"),toNumber:a("mout/lang/toNumber"),get:a("mout/object/get"),deepMixIn:a("mout/object/deepMixIn"),deepFillIn:a("mout/object/deepFillIn"),forOwn:a("mout/object/forOwn"),keys:a("mout/object/keys"),pick:a("mout/object/pick"),filter:a("mout/object/filter"),map:a("mout/object/map"),merge:a("mout/object/merge"),unset:a("mout/object/unset"),contains:a("mout/array/contains"),intersection:a("mout/array/intersection"),difference:a("mout/array/difference"),unique:a("mout/array/unique"),toInt:a("mout/number/toInt"),errMsg:function(a,b,c){return{rule:a,actual:b,expected:c}},parallel:function(a,b){function c(a){e+=1,(a||e>=f)&&b(a,d)}var d={},e=0,f=0;this.forOwn(a,function(){f+=1}),this.forOwn(a,function(a,b){a(function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[b]=e,c(a)})})}}},{"mout/array/contains":6,"mout/array/difference":7,"mout/array/intersection":11,"mout/array/unique":14,"mout/lang/isArray":20,"mout/lang/isBoolean":21,"mout/lang/isDate":22,"mout/lang/isEmpty":23,"mout/lang/isFunction":24,"mout/lang/isNumber":26,"mout/lang/isObject":27,"mout/lang/isString":30,"mout/lang/isUndefined":31,"mout/lang/toNumber":33,"mout/lang/toString":34,"mout/number/toInt":35,"mout/object/deepFillIn":36,"mout/object/deepMixIn":38,"mout/object/filter":39,"mout/object/forOwn":41,"mout/object/get":42,"mout/object/keys":45,"mout/object/map":46,"mout/object/merge":47,"mout/object/pick":49,"mout/object/unset":50}],6:[function(a,b){function c(a,b){return-1!==d(a,b)}var d=a("./indexOf");b.exports=c},{"./indexOf":10}],7:[function(a,b){function c(a){var b=h(arguments,1),c=e(d(a),function(a){return!f(b,function(b){return g(b,a)})});return c}var d=a("./unique"),e=a("./filter"),f=a("./some"),g=a("./contains"),h=a("./slice");b.exports=c},{"./contains":6,"./filter":9,"./slice":12,"./some":13,"./unique":14}],8:[function(a,b){function c(a,b,c){b=d(b,c);var e=!0;if(null==a)return e;for(var f=-1,g=a.length;++f<g;)if(!b(a[f],f,a)){e=!1;break}return e}var d=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":16}],9:[function(a,b){function c(a,b,c){b=d(b,c);var e=[];if(null==a)return e;for(var f,g=-1,h=a.length;++g<h;)f=a[g],b(f,g,a)&&e.push(f);return e}var d=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":16}],10:[function(a,b){function c(a,b,c){if(c=c||0,null==a)return-1;for(var d=a.length,e=0>c?d+c:c;d>e;){if(a[e]===b)return e;e++}return-1}b.exports=c},{}],11:[function(a,b){function c(a){var b=h(arguments,1),c=e(d(a),function(a){return f(b,function(b){return g(b,a)})});return c}var d=a("./unique"),e=a("./filter"),f=a("./every"),g=a("./contains"),h=a("./slice");b.exports=c},{"./contains":6,"./every":8,"./filter":9,"./slice":12,"./unique":14}],12:[function(a,b){function c(a,b,c){var d=a.length;b=null==b?0:0>b?Math.max(d+b,0):Math.min(b,d),c=null==c?d:0>c?Math.max(d+c,0):Math.min(c,d);for(var e=[];c>b;)e.push(a[b++]);return e}b.exports=c},{}],13:[function(a,b){function c(a,b,c){b=d(b,c);var e=!1;if(null==a)return e;for(var f=-1,g=a.length;++f<g;)if(b(a[f],f,a)){e=!0;break}return e}var d=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":16}],14:[function(a,b){function c(a,b){return b=b||d,e(a,function(a,c,d){for(var e=d.length;++c<e;)if(b(a,d[c]))return!1;return!0})}function d(a,b){return a===b}var e=a("./filter");b.exports=c},{"./filter":9}],15:[function(a,b){function c(a){return a}b.exports=c},{}],16:[function(a,b){function c(a,b){if(null==a)return d;switch(typeof a){case"function":return"undefined"!=typeof b?function(c,d,e){return a.call(b,c,d,e)}:a;case"object":return function(b){return f(b,a)};case"string":case"number":return e(a)}}var d=a("./identity"),e=a("./prop"),f=a("../object/deepMatches");b.exports=c},{"../object/deepMatches":37,"./identity":15,"./prop":17}],17:[function(a,b){function c(a){return function(b){return b[a]}}b.exports=c},{}],18:[function(a,b){function c(a){switch(h(a)){case"Object":return d(a);case"Array":return g(a);case"RegExp":return e(a);case"Date":return f(a);default:return a}}function d(a){return i(a)?j({},a):a}function e(a){var b="";return b+=a.multiline?"m":"",b+=a.global?"g":"",b+=a.ignoreCase?"i":"",new RegExp(a.source,b)}function f(a){return new Date(+a)}function g(a){return a.slice()}var h=a("./kindOf"),i=a("./isPlainObject"),j=a("../object/mixIn");b.exports=c},{"../object/mixIn":48,"./isPlainObject":28,"./kindOf":32}],19:[function(a,b){function c(a,b){switch(h(a)){case"Object":return d(a,b);case"Array":return e(a,b);default:return f(a)}}function d(a,b){if(i(a)){var d={};return g(a,function(a,d){this[d]=c(a,b)},d),d}return b?b(a):a}function e(a,b){for(var d=[],e=-1,f=a.length;++e<f;)d[e]=c(a[e],b);return d}var f=a("./clone"),g=a("../object/forOwn"),h=a("./kindOf"),i=a("./isPlainObject");b.exports=c},{"../object/forOwn":41,"./clone":18,"./isPlainObject":28,"./kindOf":32}],20:[function(a,b){var c=a("./isKind"),d=Array.isArray||function(a){return c(a,"Array")};b.exports=d},{"./isKind":25}],21:[function(a,b){function c(a){return d(a,"Boolean")}var d=a("./isKind");b.exports=c},{"./isKind":25}],22:[function(a,b){function c(a){return d(a,"Date")}var d=a("./isKind");b.exports=c},{"./isKind":25}],23:[function(a,b){function c(a){if(null==a)return!0;if("string"==typeof a||e(a))return!a.length;if("object"==typeof a){var b=!0;return d(a,function(){return b=!1,!1}),b}return!0}var d=a("../object/forOwn"),e=a("./isArray");b.exports=c},{"../object/forOwn":41,"./isArray":20}],24:[function(a,b){function c(a){return d(a,"Function")}var d=a("./isKind");b.exports=c},{"./isKind":25}],25:[function(a,b){function c(a,b){return d(a)===b}var d=a("./kindOf");b.exports=c},{"./kindOf":32}],26:[function(a,b){function c(a){return d(a,"Number")}var d=a("./isKind");b.exports=c},{"./isKind":25}],27:[function(a,b){function c(a){return d(a,"Object")}var d=a("./isKind");b.exports=c},{"./isKind":25}],28:[function(a,b){function c(a){return!!a&&"object"==typeof a&&a.constructor===Object}b.exports=c},{}],29:[function(a,b){function c(a){switch(typeof a){case"string":case"number":case"boolean":return!0}return null==a}b.exports=c},{}],30:[function(a,b){function c(a){return d(a,"String")}var d=a("./isKind");b.exports=c},{"./isKind":25}],31:[function(a,b){function c(a){return a===d}var d;b.exports=c},{}],32:[function(a,b){function c(a){return null===a?"Null":a===d?"Undefined":e.exec(f.call(a))[1]}var d,e=/^\[object (.*)\]$/,f=Object.prototype.toString;b.exports=c},{}],33:[function(a,b){function c(a){return"number"==typeof a?a:a?"string"==typeof a?parseFloat(a):d(a)?0/0:Number(a):0}var d=a("./isArray");b.exports=c},{"./isArray":20}],34:[function(a,b){function c(a){return null==a?"":a.toString()}b.exports=c},{}],35:[function(a,b){function c(a){return~~a}b.exports=c},{}],36:[function(a,b){function c(a){for(var b,f=0,g=arguments.length;++f<g;)b=arguments[f],b&&d(b,function(b,d){var f=a[d];null==f?a[d]=b:e(f)&&e(b)&&c(f,b)});return a}var d=a("./forOwn"),e=a("../lang/isPlainObject");b.exports=c},{"../lang/isPlainObject":28,"./forOwn":41}],37:[function(a,b){function c(a,b){for(var c=-1,d=a.length;++c<d;)if(f(a[c],b))return!0;return!1}function d(a,b){for(var d=-1,e=b.length;++d<e;)if(!c(a,b[d]))return!1;return!0}function e(a,b){var c=!0;return g(b,function(b,d){return f(a[d],b)?void 0:c=!1}),c}function f(a,b){return a&&"object"==typeof a?h(a)&&h(b)?d(a,b):e(a,b):a===b}var g=a("./forOwn"),h=a("../lang/isArray");b.exports=f},{"../lang/isArray":20,"./forOwn":41}],38:[function(a,b){function c(a){for(var b,c=0,f=arguments.length;++c<f;)b=arguments[c],b&&e(b,d,a);return a}function d(a,b){var d=this[b];f(a)&&f(d)?c(d,a):this[b]=a}var e=a("./forOwn"),f=a("../lang/isPlainObject");b.exports=c},{"../lang/isPlainObject":28,"./forOwn":41}],39:[function(a,b){function c(a,b,c){b=e(b,c);var f={};return d(a,function(a,c,d){b(a,c,d)&&(f[c]=a)}),f}var d=a("./forOwn"),e=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":16,"./forOwn":41}],40:[function(a,b){function c(){g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=!0;for(var a in{toString:null})f=!1}function d(a,b,d){var i,j=0;null==f&&c();for(i in a)if(e(b,a,i,d)===!1)break;if(f)for(var k=a.constructor,l=!!k&&a===k.prototype;(i=g[j++])&&("constructor"===i&&(l||!h(a,i))||a[i]===Object.prototype[i]||e(b,a,i,d)!==!1););}function e(a,b,c,d){return a.call(d,b[c],c,b)}var f,g,h=a("./hasOwn");b.exports=d},{"./hasOwn":44}],41:[function(a,b){function c(a,b,c){e(a,function(e,f){return d(a,f)?b.call(c,a[f],f,a):void 0})}var d=a("./hasOwn"),e=a("./forIn");b.exports=c},{"./forIn":40,"./hasOwn":44}],42:[function(a,b){function c(a,b){for(var c=b.split("."),d=c.pop();b=c.shift();)if(a=a[b],null==a)return;return a[d]}a("../lang/isPrimitive");b.exports=c},{"../lang/isPrimitive":29}],43:[function(a,b){function c(a,b){return e(a,b)!==d}var d,e=a("./get");b.exports=c},{"./get":42}],44:[function(a,b){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=c},{}],45:[function(a,b){var c=a("./forOwn"),d=Object.keys||function(a){var b=[];return c(a,function(a,c){b.push(c)}),b};b.exports=d},{"./forOwn":41}],46:[function(a,b){function c(a,b,c){b=e(b,c);var f={};return d(a,function(a,c,d){f[c]=b(a,c,d)}),f}var d=a("./forOwn"),e=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":16,"./forOwn":41}],47:[function(a,b){function c(){var a,b,g,h,i=1;for(h=e(arguments[0]);g=arguments[i++];)for(a in g)d(g,a)&&(b=g[a],h[a]=f(b)&&f(h[a])?c(h[a],b):e(b));return h}var d=a("./hasOwn"),e=a("../lang/deepClone"),f=a("../lang/isObject");b.exports=c},{"../lang/deepClone":19,"../lang/isObject":27,"./hasOwn":44}],48:[function(a,b){function c(a){for(var b,c=0,f=arguments.length;++c<f;)b=arguments[c],null!=b&&e(b,d,a);return a}function d(a,b){this[b]=a}var e=a("./forOwn");b.exports=c},{"./forOwn":41}],49:[function(a,b){function c(a){for(var b,c="string"!=typeof arguments[1]?arguments[1]:d(arguments,1),e={},f=0;b=c[f++];)e[b]=a[b];return e}var d=a("../array/slice");b.exports=c},{"../array/slice":12}],50:[function(a,b){function c(a,b){if(d(a,b)){for(var c=b.split("."),e=c.pop();b=c.shift();)a=a[b];return delete a[e]}return!0}var d=a("./has");b.exports=c},{"./has":43}]},{},[2])(2)});