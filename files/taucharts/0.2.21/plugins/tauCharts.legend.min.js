/*! taucharts - v0.2.21 - 2014-12-18
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed Creative Commons */
!function(a){if("function"==typeof define&&define.amd)define(["tauCharts"],function(b){return a(b)});else if("object"==typeof module&&module.exports){{require("tauCharts")}module.exports=a()}else a(this.tauCharts)}(function(a){var b=function(a){if(a.color)return a;var c,d,e,f=a.unit||[];for(c=0;c<f.length;c+=1)if(d=f[c],e=b(d))return e},c=a.api._,d=a.api.d3,e=function(){return{_delegateEvent:function(a,b,c,d){a.addEventListener(b,function(a){for(var b=a.target;b!==a.currentTarget&&null!==b;)b.classList.contains("graphical-report__legend__item")&&d(a,b),b=b.parentNode})},init:function(a){this._isNeedLegend(a)&&(this._currentFilters={},this._container=a.insertToRightSidebar(this._containerTemplate),this._delegateEvent(this._container,"click","graphical-report__legend__item",function(b,c){this._toggleLegendItem(c,a)}.bind(this)),this._delegateEvent(this._container,"mouseover","graphical-report__legend__item",function(b,c){this._highlightToggle(c,a,!0)}.bind(this)),this._delegateEvent(this._container,"mouseout","graphical-report__legend__item:not(.disabled)",function(b,c){this._highlightToggle(c,a,!1)}.bind(this)))},_highlightToggle:function(a,b,c){var e=b.getSVG(),f=d.select(e);if(a.classList.contains("disabled")&&(c=!1),c){var g=JSON.parse(a.getAttribute("data-value")),h=g.color;f.selectAll(".i-role-datum").classed({"graphical-report__highlighted":!1}),f.selectAll(".i-role-datum."+h).classed({"graphical-report__highlighted":!0}),f.classed({"graphical-report__highlighted_chart":!0})}else f.selectAll(".i-role-datum").classed({"graphical-report__highlighted":!1}),f.classed({"graphical-report__highlighted_chart":!1})},_toggleLegendItem:function(a,b){var c=a.getAttribute("data-value"),d=this._currentFilters[c];if(d)this._currentFilters[c]=null,a.classList.remove("disabled"),b.removeFilter(d);else{this._currentFilters[c]=1;var e=JSON.parse(c),f={tag:"legend",predicate:function(a){return a[e.dimension]!=e.value}};a.classList.add("disabled"),this._currentFilters[c]=b.addFilter(f)}},_isNeedLegend:function(a){var c=a.getConfig();return Boolean(b(c.spec.unit))},onUnitReady:function(a,b){-1!==b.type.indexOf("ELEMENT")&&(this._unit=b)},_getColorMap:function(a,b,d){var e=a.getData({excludeFilter:["legend"]}),f=c.map(e,function(a){return a[d]});return c.unique(f).reduce(function(a,c){return a[c]=b.get(c),a},{})},_containerTemplate:'<div class="graphical-report__legend"></div>',_template:c.template('<div class="graphical-report__legend__title"><%=name%></div><%=items%>'),_itemTemplate:c.template(["<div data-value='<%=value%>' class=\"graphical-report__legend__item <%=classDisabled%>\">",'<div class="graphical-report__legend__guide <%=color%>" ></div><%=label%>',"</div>"].join("")),onRender:function(a){if(this._container){var d=this._unit.options.color,e=d.dimension,f=this._getColorMap(a,d,e),g=a.getConfig(),h=b(g.spec.unit);h.guide=h.guide||{},h.guide.color=this._unit.guide.color,h.guide.color.brewer=f;var i=c.map(f,function(a,b){var d=JSON.stringify({dimension:e,value:b,color:a});return this._itemTemplate({color:a,classDisabled:this._currentFilters[d]?"disabled":"",label:c.escape(b),value:d})},this).join("");this._container.innerHTML=this._template({items:i,name:this._unit.guide.color.label.text||this._unit.options.color.dimension})}}}};return a.api.plugins.add("legend",e),e});