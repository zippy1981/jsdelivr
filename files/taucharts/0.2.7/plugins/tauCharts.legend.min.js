/*! tauCharts - v0.2.7 - 2014-12-15
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed Creative Commons */
!function(a){if("function"==typeof define&&define.amd)define(["tauCharts"],function(b){return a(b)});else if("object"==typeof module&&module.exports){{require("tauCharts")}module.exports=a()}else a(this.tauCharts)}(function(a){var b=function(a){if(a.color)return a;var c,d,e,f=a.unit||[];for(c=0;c<f.length;c+=1)if(d=f[c],e=b(d))return e},c=a.api._,d=function(){return{init:function(a){this.isNeedLegend(a)&&(this._currentFilters={},this._container=a.insertToRightSidebar(this.containerTemplate),this._container.addEventListener("click",function(b){for(var c=b.target;c!==b.currentTarget&&null!==c;)c.classList.contains("graphical-report__legend__item")&&this._toggleLegendItem(c,a),c=c.parentNode}.bind(this)))},_toggleLegendItem:function(a,b){var c=a.getAttribute("data-value"),d=this._currentFilters[c];if(d)this._currentFilters[c]=null,b.removeFilter(d);else{this._currentFilters[c]=1;var e=JSON.parse(c),f={tag:"legend",predicate:function(a){return a[e.dimension]!=e.value}};this._currentFilters[c]=b.addFilter(f)}},isNeedLegend:function(a){var c=a.getConfig();return Boolean(b(c.spec.unit))},onUnitReady:function(a,b){-1!==b.type.indexOf("ELEMENT")&&(this._unit=b)},_getColorMap:function(a,b,d){var e=a.getData({excludeFilter:["legend"]}),f=c.map(e,function(a){return a[d]});return c.unique(f).reduce(function(a,c){return a[c]=b.get(c),a},{})},containerTemplate:'<div class="graphical-report__legend"></div>',template:c.template('<div class="graphical-report__legend__title"><%=name%></div><%=items%>'),itemTemplate:c.template(["<div data-value='<%=value%>' class=\"graphical-report__legend__item <%=classDisabled%>\">",'<div class="graphical-report__legend__guide <%=color%>" ></div><%=label%>',"</div>"].join("")),onRender:function(a){if(this._container){var d=this._unit.options.color,e=d.dimension,f=this._getColorMap(a,d,e),g=a.getConfig(),h=b(g.spec.unit);h.guide=h.guide||{},h.guide.color=this._unit.guide.color,h.guide.color.brewer=f;var i=c.map(f,function(a,b){var d=JSON.stringify({dimension:e,value:b});return this.itemTemplate({color:a,classDisabled:this._currentFilters[d]?"disabled":"",label:c.escape(b),value:d})},this).join("");this._container.innerHTML=this.template({items:i,name:this._unit.guide.color.label.text||this._unit.options.color.dimension})}}}};return a.api.plugins.add("legend",d),d});