"use strict";angular.module("pusher-angular",[]).factory("$pusher",["$rootScope","$channel","$connection",function(a,b,c){function d(a){return this instanceof d?(this._assertValidClient(a),this.client=a,this.connection=c(a.connection,a),this.channels={},void 0):new d(a)}return d.prototype={subscribe:function(a){var c=b(this.client.subscribe(a),this);return this.channels[a]=c,c},unsubscribe:function(a){this.client.channel(a)&&(this.client.unsubscribe(a),this.channels[a]&&delete this.channels[a])},bind:function(b,c){this.client.bind(b,function(b){c(b),a.$digest()})},bind_all:function(b){this.client.bind_all(function(c,d){b(c,d),a.$digest()})},disconnect:function(){this.client.disconnect()},channel:function(a){return this.channels[a]},allChannels:function(){return this.channels},_assertValidClient:function(a){if(!angular.isObject(a)||!angular.isObject(a.connection)||"function"!=typeof a.channel)throw new Error("Invalid Pusher client object")}},d}]).factory("$channel",["$rootScope","$members",function(a,b){function c(a){if(-1==a.indexOf("presence-")&&-1==a.indexOf("private-"))throw new Error("Presence or private channel required")}function d(a,c){return this instanceof d?(this._assertValidChannel(a),this.baseChannel=a,this.client=c,this.name=a.name,this.members=-1==a.name.indexOf("presence")?function(){throw new Error("Members object only exists for presence channels")}:b(a.members,a),void 0):new d(a,c)}return d.prototype={bind:function(b,c){this.baseChannel.bind(b,function(b){c(b),a.$digest()})},bind_all:function(b){this.baseChannel.bind_all(function(c,d){b(c,d),a.$digest()})},trigger:function(a,b){if(c(this.name),-1==a.indexOf("client-"))throw new Error("Event name requires 'client-' prefix");return this.baseChannel.trigger(a,b)},_assertValidChannel:function(a){if(!angular.isObject(a)||"string"!=typeof a.name)throw new Error("Invalid Pusher channel object")}},d}]).factory("$members",["$rootScope",function(a){function b(c,d){if(!(this instanceof b))return new b(c,d);var e=this;this._assertValidMembers(c),this.baseMembers=c,this.baseChannel=d,this.me={},this.count=0,this.members={},d.bind("pusher:subscription_succeeded",function(b){e.me=b.me,e.count=b.count,e.members=b.members,a.$digest()}),d.bind("pusher:member_added",function(b){e.count++,e.members[b.id.toString()]=b.info?b.info:null,a.$digest()}),d.bind("pusher:member_removed",function(b){e.count--,delete e.members[b.id.toString()],a.$digest()})}return b.prototype={get:function(a){return this.baseMembers.get(a)},each:function(b){this.baseMembers.each(function(c){b(c),a.$digest()})},_assertValidMembers:function(a){if(!angular.isObject(a)||"object"!=typeof a.me)throw new Error("Invalid Pusher channel members object")}},b}]).factory("$connection",["$rootScope",function(a){function b(a,c){return this instanceof b?(this._assertValidConnection(a),this.baseConnection=a,this.baseClient=c,void 0):new b(a,c)}return b.prototype={bind:function(b,c){this.baseConnection.bind(b,function(b){c(b),a.$digest()})},bind_all:function(b){this.baseConnection.bind_all(function(c,d){b(c,d),a.$digest()})},_assertValidConnection:function(a){if(!angular.isObject(a))throw new Error("Invalid Pusher connection object")}},b}]);