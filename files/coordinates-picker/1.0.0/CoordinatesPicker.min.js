/*!
 * @version 1.0.0
 * @author Barin Britva
 * @license The MIT License (MIT) Copyright (c) 2014
 * @link https://github.com/barinbritva/coordinates-picker
 */
(function(e,d){return"function"===typeof define&&define.amd?define(["jquery","googlemaps"],d):e["BarinBritva.CoordinatesPicker"]=d(e.jQuery,e.google)})(this,function(e,d){"undefined"===typeof BarinBritva&&(BarinBritva={});BarinBritva.CoordinatesPicker=function(a){this._construct(a)};BarinBritva.CoordinatesPicker.prototype={_addressFields:null,_mapContainer:null,_coordinateField:null,_coordinatesFormat:"lng lat",_defaultCoordinates:new d.maps.LatLng(59.95,30.317),_defaultZoom:4,_zoomLevels:{country:4,
locality:10,route:15,street_address:17},_mapParams:{mapTypeId:d.maps.MapTypeId.ROADMAP},_markerParams:{draggable:!0,animation:d.maps.Animation.DROP},_selectValue:!1,_map:null,_geocoder:new d.maps.Geocoder,_marker:null,_cache:{},_lastAddress:"",_getZoomLevel:function(a){var b=this._zoomLevels;return"undefined"===typeof b[a]?(a=this._map.getZoom(),"undefined"===typeof a?this._defaultZoom:a):b[a]},_construct:function(a){this._setParams(a);delete a;this._initMap();this._watchAddress()},_setParams:function(a){var b=
["fields","container","coordinates"],c;for(c in b){var f=a[b[c]];if(!(f instanceof jQuery)||0==f.size())throw Error('Parameter "'+b[c]+'" is empty or not jQuery object.');}this._addressFields=a.fields;this._mapContainer=a.container;this._coordinateField=a.coordinates;if("undefined"!==typeof a.format)if("string"===typeof a.format)this._coordinatesFormat=a.format;else throw Error('Parameter "format" must be string value.');if("undefined"!==typeof a.selectValue)if("boolean"===typeof a.selectValue)this._selectValue=
a.selectValue;else throw Error('Parameter "selectValue" must be boolean value.');if("undefined"!==typeof a.center)if(a.center instanceof d.maps.LatLng)this._defaultCoordinates=a.center;else if(a.center instanceof Array){if(2!==a.center.length||isNaN(a.center[0])||isNaN(a.center[1]))throw Error('Parameter "center" must have only two numbers.');this._defaultCoordinates=new d.maps.LatLng(a.center[0],a.center[1])}else throw Error('Parameter "center" is not google.maps.LatLng object or array.');if("undefined"!==
typeof a.zooms)if(a.zooms instanceof Object)b=a.zooms,"undefined"===typeof b.initial||isNaN(b.initial)||(this._defaultZoom=b.initial),"undefined"===typeof b.country||isNaN(b.country)||(this._zoomLevels.country=b.country),"undefined"===typeof b.locality||isNaN(b.locality)||(this._zoomLevels.locality=b.locality),"undefined"===typeof b.route||isNaN(b.route)||(this._zoomLevels.route=b.route),"undefined"===typeof b.street_address||isNaN(b.street_address)||(this._zoomLevels.street_address=b.street_address);
else throw Error('Parameter "zooms" is not object.');if("undefined"!==typeof a.marker&&a.marker instanceof Object)for(c in a.marker)this._markerParams[c]=a.marker[c];if("undefined"!==typeof a.map&&a.map instanceof Object)for(c in a.map)this._mapParams[c]=a.map[c]},_initMap:function(){var a=new d.maps.Map(this._mapContainer[0],this._mapParams),b=this;d.maps.event.addListenerOnce(a,"idle",function(){b._initView()});this._map=a},_initView:function(){var a=this._getPositionFromField();a instanceof d.maps.LatLng?
this._initByCoordinates(a):this._hasAddress()?this._initByAddress():this._initByDefault()},_getPositionFromField:function(){var a=!1,b=this._coordinatesFormat,c=b.replace("lat",""),c=c.replace("lng",""),c=this._coordinateField.val().split(c);2!=c.length||isNaN(c[0])||isNaN(c[1])||(a=b.indexOf("lng")<b.indexOf("lat")?new d.maps.LatLng(c[1],c[0]):new d.maps.LatLng(c[0],c[1]));return a},_hasAddress:function(){return""!=this._getAddressFromFields()},_getAddressFromFields:function(){var a=this,b="";this._addressFields.each(function(){var c=
e(this);""!=c.val()&&(b="select"!==c.prop("tagName").toLowerCase()||a._selectValue?b+c.val():b+c.find("option:selected").text(),b+=",")});return b=b.replace(/\,+$/,"")},_initByCoordinates:function(a){var b=this._getZoomLevel("street_address");this._markPlace(a,b)},_markPlace:function(a,b){this._setView(a,b);this._putMarker(a)},_setView:function(a,b){this._map.setCenter(a);this._map.setZoom(b);this._burnEvent({type:"viewchange"})},_putMarker:function(a){var b=this._marker;if(null===b||!this._isEqualCoordinates(b.getPosition(),
a)){this._removeMarker();b=this._markerParams;b.position=a;b.map=this._map;this._marker=b=new d.maps.Marker(b);this._setCoordinates(a);var c=this;d.maps.event.addListener(b,"dragend",function(a){c._setCoordinates(a.latLng)})}},_isEqualCoordinates:function(a,b){return a.lat()===b.lat()&&a.lng()===b.lng()},_setCoordinates:function(a){a.lat();a.lng();this._coordinateField.val(this._formatCoordinates(a));this._burnCoordinatesChange()},_formatCoordinates:function(a,b){var c="";b=b||this._coordinatesFormat;
null!==a&&(c=b.replace("lat",a.lat()),c=c.replace("lng",a.lng()));return c},_burnCoordinatesChange:function(){var a={type:"coordschange",marker:this._marker};a.position=this.getPosition();this._burnEvent(a)},_removeMarker:function(){null!==this._marker&&(this._marker.setMap(null),this._coordinateField.val(""))},_initByAddress:function(){var a=this;this._geocode(this._getAddressFromFields(),function(b){b.status==d.maps.GeocoderStatus.OK?a._markPlaceFromGeocoding(b):this._initByDefault()})},_markPlaceFromGeocoding:function(a){var b=
a.results[0].geometry.location;a=this._getZoomLevel(a.results[0].types[0]);this._markPlace(b,a)},_geocode:function(a,b){this._lastAddress=a;var c=this;this._burnEvent({type:"geocodingstart",address:a});this._geocoder.geocode({address:a},function(d,e){c._burnEvent({type:"geocodingend",address:a,status:e,results:d});var g={status:e,results:d};c._cache[a]=g;b(g)})},_initByDefault:function(){this._setView(this._defaultCoordinates,this._defaultZoom)},_watchAddress:function(){var a=this,b=0;this._addressFields.on("change keyup",
function(){var c=a._getAddressFromFields();""!==c&&c!==a._lastAddress&&(0<b&&clearTimeout(b),b=setTimeout(function(){a._isInCache(c)?a._markPlaceFromGeocoding(a._getCachedAddress(c)):a._geocode(c,function(b){b.status==d.maps.GeocoderStatus.OK&&a._markPlaceFromGeocoding(b)})},500))})},_isInCache:function(a){return this._cache.hasOwnProperty(a)},_getCachedAddress:function(a){return this._cache[a]},_burnEvent:function(a){var b=jQuery.Event(a.type);delete a.type;for(var c in a)b[c]=a[c];b.map=this._map;
b.mapCenter=this._map.getCenter();b.mapZoom=this._map.getZoom();this._mapContainer.trigger(b)},getMap:function(){return this._map},getMarker:function(){return this._marker},getPosition:function(){var a=this._marker;return null===a?null:a.getPosition()},getPoint:function(a){return this._formatCoordinates(this.getPosition(),a)}};return BarinBritva.CoordinatesPicker});
//# sourceMappingURL=CoordinatesPicker.min.js.map