/**
* @author Jason Dobry <jason.dobry@gmail.com>
* @file js-data-firebase.min.js
* @version 1.0.1 - Homepage <http://wwwjs-data.io/js-data-firebase>
* @copyright (c) 2014 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-firebase/blob/master/LICENSE>
*
* @overview Firebase adapter for js-data.
*/

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.DSFirebaseAdapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=!0;for(var a in{toString:null})f=!1}function d(a,b,d){var i,j=0;null==f&&c();for(i in a)if(e(b,a,i,d)===!1)break;if(f)for(var k=a.constructor,l=!!k&&a===k.prototype;(i=g[j++])&&("constructor"===i&&(l||!h(a,i))||a[i]===Object.prototype[i]||e(b,a,i,d)!==!1););}function e(a,b,c,d){return a.call(d,b[c],c,b)}var f,g,h=a("./hasOwn");b.exports=d},{"./hasOwn":3}],2:[function(a,b){function c(a,b,c){e(a,function(e,f){return d(a,f)?b.call(c,a[f],f,a):void 0})}var d=a("./hasOwn"),e=a("./forIn");b.exports=c},{"./forIn":1,"./hasOwn":3}],3:[function(a,b){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=c},{}],4:[function(a,b){function c(a){var b=[];return d(a,function(a){b.push(a)}),b}var d=a("./forOwn");b.exports=c},{"./forOwn":2}],5:[function(a,b){function c(){}function d(a){a=a||{},this.defaults=new c,j(this.defaults,a),this.ref=new f(a.basePath||this.defaults.basePath)}var e,f;try{e=a("js-data"),f=a("firebase")}catch(g){}if(!e)try{e=window.JSData,f=window.Firebase}catch(g){}if(!e)throw new Error("js-data must be loaded!");if(!f)throw new Error("firebase must be loaded!");var h=new e.DS,i=e.DSUtils,j=i.deepMixIn,k=h.defaults.defaultFilter,l=a("mout/object/values"),m=i.Promise;c.prototype.basePath="";var n=d.prototype;n.getRef=function(a,b){return b=b||{},this.ref.child(b.endpoint||a.endpoint)},n.find=function(a,b,c){var d=this;return new m(function(e,f){return d.getRef(a,c).child(b).once("value",function(a){var b=a.val();b?e(b):f(new Error("Not Found!"))},f,d)})},n.findAll=function(a,b,c){var d=this;return new m(function(e,f){return d.getRef(a,c).once("value",function(d){e(k.call(h,l(d.val()),a.name,b,c))},f,d)})},n.create=function(a,b,c){var d=this,e=b[a.idAttribute];return i.isString(e)||i.isNumber(e)?d.update(a,e,b,c):new m(function(e,f){var g=d.getRef(a,c),h=g.push(b,function(b){if(b)return f(b);var c=h.toString().replace(g.toString(),"");h.child(a.idAttribute).set(c,function(a){a?f(a):h.once("value",function(a){try{e(a.val())}catch(b){f(b)}},f,d)})})})},n.update=function(a,b,c,d){var e=this;return new m(function(f,g){var h=e.getRef(a,d).child(b);h.once("value",function(b){try{var d,e,i,k=b.val()||{};if(a.relations)for(d=a.relationFields,e=[],i=0;d.length;i++)e.push(c[d[i]]),delete c[d[i]];if(j(k,c),a.relations)for(d=a.relationFields,i=0;d.length;i++)c[d[i]]=e.shift();h.set(k,function(a){a?g(a):f(k)})}catch(l){g(l)}},g,e)})},n.updateAll=function(a,b,c,d){var e=this;return e.findAll(a,c,d).then(function(c){var f=[];return i.forEach(c,function(c){f.push(e.update(a,c[a.idAttribute],b,d))}),m.all(f)})},n.destroy=function(a,b,c){var d=this;return new m(function(e,f){d.getRef(a,c).child(b).remove(function(a){a?f(a):e()})})},n.destroyAll=function(a,b,c){var d=this;return d.findAll(a,b,c).then(function(b){var e=[];return i.forEach(b,function(b){e.push(d.destroy(a,b[a.idAttribute],c))}),m.all(e)})},b.exports=d},{firebase:"firebase","js-data":"js-data","mout/object/values":4}]},{},[5])(5)});
//# sourceMappingURL=js-data-firebase.min.map