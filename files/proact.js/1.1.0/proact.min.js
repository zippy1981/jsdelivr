!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a():window.Pro=window.ProAct=window.P=a()}(function(){{var a,b,c,d,e,f,g,h,i,j,k=Pro=P={},l=Array.prototype,m=l.concat,n=l.every,o=l.filter,p=l.forEach,q=l.indexOf,r=l.join,s=l.lastIndexOf,t=l.map,u=l.pop,v=l.push,w=l.reduce,x=l.reduceRight,y=l.reverse,z=l.shift,A=l.slice,B=l.some,C=l.sort,D=l.splice,E=l.toLocaleString,F=l.toString;l.unshift}return k.VERSION="1.1.0",k.States={init:1,ready:2,destroyed:3,error:4},k.Utils=Pro.U={uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},isFunction:function(a){return"function"==typeof a},isString:function(a){return"string"==typeof a},isObject:function(a){return"object"==typeof a},isEmptyObject:function(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0},isError:function(a){return null!==a&&a instanceof Error},isArray:function(a){return P.U.isObject(a)&&"[object Array]"===Object.prototype.toString.call(a)},isProArray:function(a){return null!==a&&P.U.isObject(a)&&P.U.isArray(a._array)&&void 0!==a.length},isArrayObject:function(a){return P.U.isArray(a)||P.U.isProArray(a)},isProObject:function(a){return a&&k.U.isObject(a)&&void 0!==a.__pro__&&k.U.isObject(a.__pro__.properties)},isProVal:function(a){return P.U.isProObject(a)&&void 0!==a.__pro__.properties.v},clone:function(a){if(P.U.isArray(a)){var b,c=a.length,d=[];for(b=0;c>b;b++)d.push(P.U.clone(a[b]));return d}return a},ex:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=P.U.clone(b[c]));return a},extendClass:function(a){var b=this,c=function(){b.apply(this,A.call(arguments))};return P.U.ex(c,b),c.initData={},P.U.ex(c.initData,b.initData),P.U.ex(c.prototype,b.prototype),P.U.ex(c.initData,a),c.uuid=P.U.uuid(),c.prototype.constructor=c,c},bind:function(a,b){return function(){return b.apply(a,arguments)}},contains:function(a,b){-1!==a.indexOf(b)},remove:function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},diff:function(a,b){var c,d,e,f=-1,g=a.length,h=b.length,i={};if(g>=h){for(c=0;h>c;c++)d=a[c],e=b[c],d!==e?(-1===f&&(f=c),i[f]=i[f]||{o:[],n:[]},i[f].o.push(d),i[f].n.push(e)):f=-1;for(-1===f&&(f=c),i[f]=i[f]||{o:[],n:[]};g>c;c++)d=a[c],i[f].o.push(d)}else{i=P.U.diff(b,a);for(c in i)el1=i[c],el2=el1.n,el1.n=el1.o,el1.o=el2}return i},defValProp:function(a,b,c,d,e,f){try{Object.defineProperty(a,b,{enumerable:c,configurable:d,writable:e,value:f})}catch(g){a[b]=f}}},k.Configuration={keyprops:!0,keypropList:["p"]},k.N=function(){},k.currentCaller=null,k.Queue=P.Q=function(a,b){this.name=a||"proq",this.options=b||{},this._queue=[]},k.Queue.runAction=function(a,b,c,d,e){if(d&&d.length>0)if(e)try{c.apply(b,d)}catch(f){e(a,f)}else c.apply(b,d);else if(e)try{c.call(b)}catch(f){e(a,f)}else c.call(b)},P.Q.prototype={constructor:k.Queue,length:function(){return this._queue.length/4},isEmpty:function(){return 0===this.length()},push:function(a,b,c){a&&P.U.isFunction(a)&&(c=b,b=a,a=null),this._queue.push(a,b,c,1)},pushOnce:function(a,b,c){a&&P.U.isFunction(a)&&(c=b,b=a,a=null);var d,e,f,g=this._queue,h=g.length;for(f=0;h>f;f+=4)if(d=g[f],e=g[f+1],d===a&&e===b)return g[f+2]=c,void(g[f+3]=g[f+3]+1);this.push(a,b,c)},go:function(a){var b,c,d,e,f,g=this._queue,h=this.options,i=(this.runs,g.length),j=h&&h.before,k=h&&h.after,l=h&&h.err,m=i,n=!0,o=1,p=m;for(i&&j&&j(this);n;){for(n=!1,m=p,b=0;m>b;b+=4)c=g[b],d=g[b+1],e=g[b+2],f=g[b+3],f===o?P.Q.runAction(this,c,d,e,l):f>o&&(n=!0,p=b+4);o+=1}i&&k&&k(this),g.length>i?(this._queue=g.slice(i),a||this.go()):this._queue.length=0}},P.Q.prototype.defer=P.Q.prototype.enque=P.Q.prototype.add=P.Q.prototype.push,P.Q.prototype.deferOnce=P.Q.prototype.enqueOnce=P.Q.prototype.addOnce=P.Q.prototype.pushOnce,P.Q.prototype.run=P.Q.prototype.go,k.Queues=P.QQ=function(a,b){a||(a=["proq"]),this.queueNames=a,this.options=b||{},this._queues={};var c,d=this.queueNames.length;for(c=0;d>c;c++)this._queues[this.queueNames[c]]=new P.Q(this.queueNames[c],this.options.queue)},P.QQ.prototype={constructor:k.Queues,isEmpty:function(){var a,b,c,d=this._queues,e=this.queueNames,f=e.length;for(a=0;f>a;a++)if(b=e[a],c=d[b],!c.isEmpty())return!1;return!0},push:function(a,b,c,d){a&&!P.U.isString(a)&&(d=c,c=b,b=a,a=this.queueNames[0]),a||(a=this.queueNames[0]);var e=this._queues[a];e&&e.push(b,c,d)},pushOnce:function(a,b,c,d){a&&!P.U.isString(a)&&(d=c,c=b,b=a,a=this.queueNames[0]),a||(a=this.queueNames[0]);var e=this._queues[a];e&&e.pushOnce(b,c,d)},go:function(a){var b,c,d,e,f=0,g=this._queues,h=this.queueNames,i=this.queueNames.length;if(a)for(b=0;i>b;b++)h[b]===a&&(f=b);for(;i>f;)c=h[f],d=g[c],d.go(!0),-1===(e=this._probePrevIndex(f))?f+=1:f=e},_probePrevIndex:function(a){var b,c,d,e=this._queues,f=this.queueNames;for(b=0;a>=b;b++)if(c=f[b],d=e[c],!d.isEmpty())return b;return-1}},P.QQ.prototype.defer=P.QQ.prototype.enque=P.QQ.prototype.add=P.QQ.prototype.push,P.QQ.prototype.deferOnce=P.QQ.prototype.enqueOnce=P.QQ.prototype.addOnce=P.QQ.prototype.pushOnce,P.QQ.prototype.flush=P.QQ.prototype.run=P.QQ.prototype.go,k.Flow=P.F=function(a,b){a||(a=["proq"]),this.queueNames=a,this.options=b||{},this.flowInstance=null,this.flowInstances=[],this.pauseMode=!1},P.F.prototype={constructor:k.Flow,start:function(){var a=this.flowInstance,b=this.options,c=b&&b.start,d=this.queueNames;a&&this.flowInstances.push(a),this.flowInstance=new P.Queues(d,b.flowInstance),c&&c(this.flowInstance)},stop:function(){var a,b=this.flowInstance,c=this.options,d=c&&c.stop;if(b)try{b.go()}finally{this.flowInstance=null,this.flowInstances.length&&(a=this.flowInstances.pop(),this.flowInstance=a),d&&d(b)}},pause:function(){this.pauseMode=!0},resume:function(){this.pauseMode=!1},run:function(a,b){var c=this.options,d=c.err;this.start(),b||(b=a,a=null);try{if(d)try{b.call(a)}catch(e){d(e)}else b.call(a)}finally{this.stop()}},isRunning:function(){return null!==this.flowInstance&&void 0!==this.flowInstance},isPaused:function(){return this.isRunning()&&this.pauseMode},push:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.push(a,b,c,d)},pushOnce:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.pushOnce(a,b,c,d)}},k.flow=new k.Flow(["proq"],{err:function(a){P.flow.errStream?P.flow.errStream().triggerErr(a):console.log(a)},flowInstance:{queue:{err:function(a,b){P.flow.errStream?P.flow.errStream().triggerErr(b):console.log(b)}}}}),P.F.prototype.begin=P.F.prototype.start,P.F.prototype.end=P.F.prototype.stop,P.F.prototype.defer=P.F.prototype.enque=P.F.prototype.add=P.F.prototype.push,P.F.prototype.deferOnce=P.F.prototype.enqueOnce=P.F.prototype.addOnce=P.F.prototype.pushOnce,P.F.prototype.flush=P.F.prototype.go=P.F.prototype.run,k.Observable=function(a){P.U.defValProp(this,"listeners",!1,!1,!0,this.defaultListeners()),this.sources=[],this.listener=null,this.errListener=null,this.transforms=a?a:[],this.parent=null},P.U.ex(P.Observable,{BadValue:{},transform:function(a,b){var c,d=a.transforms,e=d.length;for(c=0;e>c&&(b=d[c].call(a,b),b!==P.Observable.BadValue);c++);return b}}),P.Observable.prototype={constructor:k.Observable,defaultListeners:function(){return{change:[],error:[]}},defaultActions:function(){return"change"},makeListener:P.N,makeErrListener:P.N,makeEvent:function(a){return new P.Event(a,this,P.Event.Types.value)},on:function(a,b){P.U.isString(a)||P.U.isArray(a)||(b=a,a=this.defaultActions()),P.U.isArray(a)||(a=[a]);var c,d,e,f=a.length;for(d=0;f>d;d++)c=a[d],e=this.listeners[c],e||(e=this.listeners[c]=[]),e.push(b);return this},off:function(a,b){if(!a&&!b)return this.listeners=this.defaultListeners(),this;P.U.isString(a)||P.U.isArray(a)||(b=a,a=this.defaultActions()),P.U.isArray(a)||(a=[a]);var c,d,e,f=a.length;for(d=0;f>d;d++)c=a[d],e=this.listeners[c],e&&P.U.remove(e,b);return this},onErr:function(a){return this.on("error",a)},offErr:function(a){return this.off("error",a)},into:function(){var a,b,c=A.call(arguments),d=c.length;for(a=0;d>a;a++)b=c[a],this.sources.push(b),b.on(this.makeListener()),b.onErr(this.makeErrListener());return this},out:function(a){return a.into(this),this},offSource:function(a){return P.U.remove(this.sources,a),a.off(this.listener),a.offErr(this.errListener),this},transform:function(a){return this.transforms.push(a),this},mapping:function(a){return this.transform(a)},filtering:function(a){var b=this;return this.transform(function(c){return a.call(b,c)?c:P.Observable.BadValue})},accumulation:function(a,b){var c=this,d=a;return this.transform(function(a){return d=b.call(c,d,a)})},map:P.N,filter:P.N,accumulate:P.N,reduce:function(a,b){return new P.Val(a).into(this.accumulate(a,b))},update:function(a,b,c){var d=this;return P.flow.isRunning()?d.willUpdate(a,b,c):P.flow.run(function(){d.willUpdate(a,b,c)}),this},willUpdate:function(a,b,c){b||(b=this.defaultActions());var d,e,f,g,h,i;if(P.U.isString(b))g=this.listeners[b];else{if(g=[],d=b.length,null===this.parent&&0===b.length)return this;for(e=0;d>e;e++)listenersForAction=this.listeners[b[e]],listenersForAction&&(g=g.concat(listenersForAction))}if(0===g.length&&null===this.parent)return this;for(h=g.length,i=this.makeEvent(a,c),e=0;h>e;e++)f=g[e],this.defer(i,f),f.property&&f.property.willUpdate(i);return this.parent&&this.parent.call&&this.defer(i,this.parent),this},defer:function(a,b){return P.U.isFunction(b)?P.flow.pushOnce(b,[a]):P.flow.pushOnce(b,b.call,[a]),this}},k.Event=P.E=function(a,b,c){this.source=a,this.target=b,this.type=c,this.args=A.call(arguments,3)},P.U.ex(k.Event,{make:function(a,b,c,d){return"array"===c||c===P.E.Types.array?P.E.makeArray(d[0],d.slice(1)):void 0},makeArray:function(a,b,c,d){var e=P.E.Types.array;return"remove"===c||c===P.A.Operations.remove?new P.E(a,b,e,P.A.Operations.remove,d[0],d[1],d[2]):"splice"===c||c===P.A.Operations.splice?(P.U.isArray(d[1])||(d[1]=new Array(d[1])),new P.E(a,b,e,P.A.Operations.splice,d[0],d[1],d[2])):void 0},simple:function(a,b,c,d){if(!("array"!==a&&"a"!==a||"pop"!==b&&"shift"!==b))return P.E.makeArray(null,d,"remove",["shift"===b?0:1]);if(("array"===a||"a"===a)&&"splice"===b)return P.E.makeArray(null,d,"splice",[c,1]);if(!("array"!==a&&"a"!==a||"deleteElement"!==b&&"del"!==b)){if(!d)return P.E.makeArray(null,d,"splice",[null,[c]]);var e=d.indexOf(c);if(-1!==e)return P.E.makeArray(null,d,"splice",[e,1])}return null}}),k.Event.Types={value:0,array:1,close:2,error:3},k.Stream=k.S=function(a,b){P.Observable.call(this,b),a&&this.into(a)},k.Stream.prototype=P.U.ex(Object.create(P.Observable.prototype),{constructor:k.Stream,makeEvent:function(a){return a},makeListener:function(){if(!this.listener){var a=this;this.listener=function(b){a.trigger(b,!0)}}return this.listener},makeErrListener:function(){if(!this.errListener){var a=this;this.errListener=function(b){a.triggerErr(b)}}return this.errListener},defer:function(a,b){return b.property?void P.Observable.prototype.defer.call(this,a,b):void(P.U.isFunction(b)?P.flow.push(b,[a]):P.flow.push(b,b.call,[a]))},trigger:function(a,b){return void 0===b&&(b=!0),this.go(a,b)},triggerMany:function(){var a,b=A.call(arguments),c=b.length;for(a=0;c>a;a++)this.trigger(b[a],!0);return this},triggerErr:function(a){return this.update(a,"error")},go:function(a,b){{var c=this.transforms;c.length}if(b)try{a=P.Observable.transform(this,a)}catch(d){return this.triggerErr(d),this}return a===P.Observable.BadValue?this:this.update(a)},map:function(a){return new P.S(this).mapping(a)},filter:function(a){return new P.S(this).filtering(a)},accumulate:function(a,b){return new P.S(this).accumulation(a,b)},merge:function(){var a=[this].concat(A.call(arguments)),b=new P.S;return P.S.prototype.into.apply(b,a)}}),P.U.ex(P.F.prototype,{errStream:function(){return this.errStreamVar||(this.errStreamVar=new P.S),this.errStreamVar}}),P.S.prototype.t=P.S.prototype.trigger,P.S.prototype.tt=P.S.prototype.triggerMany,P.S.prototype.te=P.S.prototype.triggerErr,k.BufferedStream=P.BS=function(a,b){P.S.call(this,a,b),this.buffer=[]},k.BufferedStream.prototype=P.U.ex(Object.create(P.S.prototype),{constructor:k.BufferedStream,flush:function(){var a,b=this,c=this.buffer,d=c.length;return P.flow.run(function(){for(a=0;d>a;a+=2)b.go(c[a],c[a+1]);b.buffer=[]}),this}}),k.SizeBufferedStream=P.SBS=function(a,b,c){if(1===arguments.length&&"number"==typeof a?(c=a,a=null):2===arguments.length&&"number"==typeof b&&(c=b,b=null),P.BS.call(this,a,b),!c)throw new Error("SizeBufferedStream must contain size!");this.size=c},k.SizeBufferedStream.prototype=P.U.ex(Object.create(P.BS.prototype),{constructor:k.SizeBufferedStream,trigger:function(a,b){return this.buffer.push(a,b),null!==this.size&&this.buffer.length/2===this.size&&this.flush(),this}}),P.U.ex(P.S.prototype,{bufferit:function(a){return new P.SBS(this,a)}}),P.SBS.prototype.t=P.SBS.prototype.trigger,k.DelayedStream=P.DBS=function(a,b,c){"number"==typeof a?(c=a,a=null):P.U.isObject(a)&&"number"==typeof b&&(c=b,b=null),P.BS.call(this,a,b),this.delayId=null,this.setDelay(c)},k.DelayedStream.prototype=P.U.ex(Object.create(P.BS.prototype),{constructor:k.DelayedStream,trigger:function(a,b){return this.buffer.push(a,b),this},cancelDelay:function(){return null!==this.delayId&&(clearInterval(this.delayId),this.delayId=null),this},setDelay:function(a){if(this.delay=a,this.cancelDelay(),this.delay){var b=this;return this.delayId=setInterval(function(){b.flush()},this.delay),this}}}),P.U.ex(P.S.prototype,{delay:function(a){return new P.DBS(this,a)}}),P.DBS.prototype.t=P.DBS.prototype.trigger,k.ThrottlingStream=P.TDS=function(a,b,c){P.DBS.call(this,a,b,c)},k.ThrottlingStream.prototype=P.U.ex(Object.create(P.DBS.prototype),{constructor:k.ThrottlingStream,trigger:function(a,b){return this.buffer[0]=a,this.buffer[1]=b,this}}),P.U.ex(P.Stream.prototype,{throttle:function(a){return new P.TDS(this,a)}}),P.TDS.prototype.t=P.TDS.prototype.trigger,k.DebouncingStream=P.DDS=function(a,b,c){P.DBS.call(this,a,b,c)},k.DebouncingStream.prototype=P.U.ex(Object.create(P.DBS.prototype),{constructor:k.DebouncingStream,trigger:function(a,b){this.buffer=[],this.cancelDelay(),this.setDelay(this.delay),this.buffer.push(a,b)}}),P.U.ex(P.Stream.prototype,{debounce:function(a){return new P.DDS(this,a)}}),P.DDS.prototype.t=P.DDS.prototype.trigger,k.Property=P.P=function(a,b,c,d){P.U.defValProp(this,"proObject",!1,!1,!0,a),this.property=b,this.proObject.__pro__||P.U.defValProp(a,"__pro__",!1,!1,!0,new k.ObjectCore(a)),this.proObject.__pro__.properties[b]=this,this.get=c||P.P.defaultGetter(this),this.set=d||P.P.defaultSetter(this),this.oldVal=null,this.val=a[b],this.state=P.States.init,this.g=this.get,this.s=this.set,P.Observable.call(this),this.parent=this.proObject.__pro__,this.init()},P.U.ex(k.Property,{Types:{simple:0,auto:1,object:2,array:3,nil:4,type:function(a){return null===a?P.P.Types.nil:P.U.isFunction(a)?P.P.Types.auto:P.U.isArray(a)?P.P.Types.array:P.U.isObject(a)?P.P.Types.object:P.P.Types.simple}},defaultGetter:function(a){return function(){return a.addCaller(),a.val}},defaultSetter:function(a,b){return function(c){return a.val!==c?(a.oldVal=a.val,a.val=b?b.call(a.proObject,c):P.Observable.transform(a,c),null===a.val||void 0===a.val?void P.P.reProb(a).update():void a.update()):void 0}},defineProp:function(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})},reProb:function(a){var b=a.proObject,c=a.property,d=a.listeners.change;return a.destroy(),b.__pro__.makeProp(c,d)}}),k.Property.prototype=P.U.ex(Object.create(P.Observable.prototype),{constructor:k.Property,type:function(){return P.P.Types.simple},makeEvent:function(a){return new P.E(a,this.property,P.E.Types.value,this.proObject,this.oldVal,this.val)},makeListener:function(){if(!this.listener){var a=this;this.listener={property:a,call:function(b){b&&void 0!==b.type&&b.type===P.E.Types.value&&3===b.args.length&&b.target&&(b=b.args[0][b.target]),a.set(b)}}}return this.listener},init:function(){this.state===P.States.init&&(P.P.defineProp(this.proObject,this.property,this.get,this.set),this.afterInit())},afterInit:function(){this.state=P.States.ready},addCaller:function(){var a=P.currentCaller;a&&a.property!==this&&this.on(a)},destroy:function(){this.state!==P.States.destroyed&&(delete this.proObject.__pro__.properties[this.property],this.listeners=void 0,this.oldVal=void 0,this.parent=void 0,P.U.defValProp(this.proObject,this.property,!0,!0,!0,this.val),this.get=this.set=this.property=this.proObject=void 0,this.g=this.s=void 0,this.val=void 0,this.state=P.States.destroyed)},toString:function(){return this.val}}),k.NullProperty=P.NP=function(a,b){var c=this,d=P.P.defaultSetter(this),e=function(a){var b=d.call(c.proObject,a),e=P.P.Types,f=e.type(b);return f!==e.nil&&P.P.reProb(c),b};P.P.call(this,a,b,P.P.defaultGetter(this),e)},k.NullProperty.prototype=P.U.ex(Object.create(P.P.prototype),{constructor:k.NullProperty,type:function(){return P.P.Types.nil}}),k.AutoProperty=P.FP=function(a,b){this.func=a[b];var c=this,d=function(){c.addCaller();var a,b=P.currentCaller,d=P.P.defaultGetter(c),e=P.P.defaultSetter(c,function(a){return c.func.call(c.proObject,a)}),f=arguments;return P.currentCaller=c.makeListener(),a=function(){c.val=c.func.apply(c.proObject,f)},P.flow.run(function(){P.flow.pushOnce(a)}),P.currentCaller=b,P.P.defineProp(c.proObject,c.property,d,e),c.state=P.States.ready,c.val=P.Observable.transform(c,c.val),c.val};P.P.call(this,a,b,d,function(){})},k.AutoProperty.prototype=P.U.ex(Object.create(P.P.prototype),{constructor:k.AutoProperty,type:function(){return P.P.Types.auto},makeListener:function(){if(!this.listener){var a=this;this.listener={property:a,call:function(){a.oldVal=a.val,a.val=P.Observable.transform(a,a.func.call(a.proObject))}}}return this.listener},afterInit:function(){}}),k.ObjectProperty=P.OP=function(a,b){var c,d=this;c=function(){d.addCaller(),d.val.__pro__||P.prob(d.val);var a=P.P.defaultGetter(d),b=function(a){if(d.val!=a){if(d.oldVal=d.val,d.val=a,null===d.val||void 0===d.val)return P.P.reProb(d).update(),d;if(d.oldVal){if(d.val.__pro__||P.prob(d.val),P.U.isArray(this))return void d.update();var b,c,e,f,g,h,i,j,k,l,m,n=d.oldVal.__pro__.properties,o=d.val.__pro__.properties,p=[];for(b in n)if(n.hasOwnProperty(b)){if(e=o[b],!e)continue;for(g=e.listeners.change,c=n[b],f=c.listeners.change,j=f.length,h=0;j>h;h++){for(l=!0,i=0;k>i;i++)f[h]==g[i]&&(l=!1);l&&(e.on(f[h]),p.push(h))}for(m=p.length,h=0;m>h;h++)f.splice[(p[h],1)];p=[]}}d.update()}};return P.P.defineProp(d.proObject,d.property,a,b),d.state=P.States.ready,d.val},P.P.call(this,a,b,c,function(){})},k.ObjectProperty.prototype=P.U.ex(Object.create(P.P.prototype),{constructor:k.ObjectProperty,type:function(){return P.P.Types.object},afterInit:function(){}}),k.ArrayProperty=P.AP=function(a,b){var c,d=this;c=function(){d.addCaller(),P.U.isProArray(d.val)||(d.val=new P.A(d.val));var a=P.P.defaultGetter(d),b=function(a){if(d.val!=a&&d.val.valueOf()!=a){if(d.oldVal=d.val,d.val=a,null===d.val||void 0===d.val)return P.P.reProb(d).update(),d;if(P.U.isProArray(d.val)||(d.val=new P.A(d.val)),d.oldVal){var b,c,e,f=[],g=d.oldVal.__pro__.listeners.index,h=g.length,i=d.val.__pro__.listeners.index,j=d.oldVal.__pro__.listeners.length,k=j.length,l=d.val.__pro__.listeners.length;for(b=0;h>b;b++)c=g[b],c.property&&c.property.proObject===d.proObject&&(i.push(c),f.push(b));for(e=f.length,b=0;e>b;b++)g.splice[(f[b],1)];for(f=[],b=0;k>b;b++)c=j[b],c.property&&c.property.proObject===d.proObject&&(l.push(c),f.push(b));for(e=f.length,b=0;e>b;b++)j.splice[(f[b],1)];f=[]}d.update()}};return P.P.defineProp(d.proObject,d.property,a,b),d.state=P.States.ready,d.val},P.P.call(this,a,b,c,function(){})},k.ArrayProperty.prototype=P.U.ex(Object.create(P.P.prototype),{constructor:k.ArrayProperty,type:function(){return P.P.Types.array},afterInit:function(){}}),k.ProxyProperty=P.PXP=function(a,b,c){var d,e,f=this;d=function(){return f.addCaller(),c.val},e=function(a){return c.val!==a?(c.oldVal=c.val,c.val=P.Observable.transform(f,a),null===c.val||void 0===c.val?void P.P.reProb(c).update():void c.update()):void 0},P.P.call(this,a,b,d,e),this.target=c,this.target.on(this.makeListener())},k.ProxyProperty.prototype=P.U.ex(Object.create(P.P.prototype),{constructor:k.ProxyProperty,type:function(){return this.target.type()},makeListener:function(){if(!this.listener){var a=this;this.listener={property:a,call:P.N}}return this.listener}}),k.PropertyProvider=P.PP=function(){},function(a){var b=[];a.U.ex(a.PP,{registerProvider:function(a){b.push(a)},prependProvider:function(a){b.unshift(a)},unregisterProvider:function(c){a.U.remove(b,c)},clearProviders:function(){b=[]},provide:function(a,c,d){var e,f=b.length,g=null,h=null;for(e=0;f>e&&(h=b[e],!h.filter(a,c,d));e++)h=null;return h&&(g=h.provide(a,c,d)),g}})}(P),k.PropertyProvider.prototype={constructor:k.PropertyProvider,filter:function(){throw new Error("Abstract! Implement!")},provide:function(){throw new Error("Abstract! Implement!")}},k.NullPropertyProvider=P.NPP=function(){P.PP.call(this)},k.NullPropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.NullPropertyProvider,filter:function(a,b){return null===a[b]||void 0===a[b]},provide:function(a,b){return new P.NP(a,b)}}),k.SimplePropertyProvider=P.SPP=function(){P.PP.call(this)},k.SimplePropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.SimplePropertyProvider,filter:function(a,b){var c=a[b];return null!==c&&void 0!==c&&!P.U.isFunction(c)&&!P.U.isArrayObject(c)&&!P.U.isObject(c)},provide:function(a,b){return new P.P(a,b)}}),k.AutoPropertyProvider=P.FPP=function(){P.PP.call(this)},k.AutoPropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.AutoPropertyProvider,filter:function(a,b){return P.U.isFunction(a[b])},provide:function(a,b){return new P.FP(a,b)}}),k.ArrayPropertyProvider=P.APP=function(){P.PP.call(this)},k.ArrayPropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.ArrayPropertyProvider,filter:function(a,b){return P.U.isArrayObject(a[b])},provide:function(a,b){return new P.AP(a,b)}}),k.ObjectPropertyProvider=P.OPP=function(){P.PP.call(this)},k.ObjectPropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.ObjectPropertyProvider,filter:function(a,b){return P.U.isObject(a[b])},provide:function(a,b){return new P.OP(a,b)}}),k.ProxyPropertyProvider=P.PXPP=function(){P.PP.call(this)},k.ProxyPropertyProvider.prototype=P.U.ex(Object.create(P.PP.prototype),{constructor:k.ProxyPropertyProvider,filter:function(a,b,c){return c&&c instanceof k.Property?c instanceof k.Property:!1},provide:function(a,b,c){return new P.PXP(a,b,c)}}),P.PP.registerProvider(new P.ProxyPropertyProvider),P.PP.registerProvider(new P.NullPropertyProvider),P.PP.registerProvider(new P.SimplePropertyProvider),P.PP.registerProvider(new P.AutoPropertyProvider),P.PP.registerProvider(new P.ArrayPropertyProvider),P.PP.registerProvider(new P.ObjectPropertyProvider),k.Core=P.C=function(a,b){this.shell=a,this.state=P.States.init,this.meta=b||{},P.Observable.call(this)},k.Core.prototype=P.U.ex(Object.create(P.Observable.prototype),{constructor:k.Core,value:function(){return this},prob:function(){var a=k.Configuration,b=a.keyprops,c=a.keypropList;try{this.setup(),b&&-1!==c.indexOf("p")&&P.U.defValProp(this.shell,"p",!1,!1,!1,P.U.bind(this,this.value)),this.state=P.States.ready}catch(d){throw this.state=P.States.error,d}return this},setup:function(){throw Error("Abstract, implement!")},call:function(a){this.update(a)}}),k.ObjectCore=P.OC=function(a,b){this.properties={},P.C.call(this,a,b)},k.ObjectCore.prototype=P.U.ex(Object.create(P.C.prototype),{constructor:k.ObjectCore,value:function(a){return a&&"*"!==a?this.properties[a]:this},setup:function(){var a,b=this.shell;for(a in b)this.makeProp(a,null,this.meta[a])},makeProp:function(a,b,c){{var d,e=this.shell,f=k.Configuration,g=f.keyprops,h=f.keypropList;P.U.isFunction,P.U.isArrayObject,P.U.isObject}if(c&&("noprop"===c||c.indexOf&&c.indexOf("noprop")>=0))return null;if(g&&-1!==h.indexOf(a))throw Error("The property name "+a+" is a key word for pro objects! Objects passed to ProAct.prob can not contain properties named as keyword properties.");return e.hasOwnProperty(a)&&(d=P.PP.provide(e,a,c)),d?(b&&(this.properties[a].listeners.change=this.properties[a].listeners.change.concat(b)),c&&P.registry&&(P.U.isArray(c)||(c=[c]),c[0]instanceof k.Property||P.registry.setup.apply(P.registry,[d].concat(c))),d):null},set:function(a,b){var c=this.shell;c[a]=b,this.properties[a]||this.makeProp(a)}}),k.ArrayCore=P.AC=function(a,b){P.C.call(this,a,b),this.lastIndexCaller=null,this.lastLengthCaller=null},k.ArrayCore.prototype=P.U.ex(Object.create(P.C.prototype),{constructor:k.ArrayCore,actionFunction:function(a){var b=this;return function(){var c,d=P.currentCaller,e=arguments[1];return P.currentCaller=b.indexListener(e),c=a.apply(this,A.call(arguments,0)),P.currentCaller=d,c}},indexListener:function(a){this.indexListeners||(this.indexListeners={});var b=this,c=b.shell;return this.indexListeners[a]||(this.indexListeners[a]={call:function(d){b.makeListener(new P.E(d,c,P.E.Types.array,[P.A.Operations.set,a,c._array[a],c._array[a]]))},property:b}),this.indexListeners[a]},makeListener:function(){if(!this.listener){var a=this.shell;this.listener=function(b){if(!(b&&b instanceof P.E))return void a.push(b);if(b.type===P.E.Types.value)return void a.push(b.args[2]);var d,e=b.args[0],f=b.args[1],g=b.args[2],h=b.args[3],i=P.Array.Operations;if(e===i.set)a[f]=h;else if(e===i.add)d=A.call(h,0),0===f?c.unshift.apply(a,d):c.push.apply(a,d);else if(e===i.remove)0===f?a.shift():a.pop();else if(e===i.setLength)a.length=h;else if(e===i.reverse)a.reverse();else if(e===i.sort)P.U.isFunction(h)?a.sort(h):a.sort();else if(e===i.splice){if(d=h?A.call(h,0):[],(null===f||void 0===f)&&(f=a.indexOf(g[0]),-1===f))return;c.splice.apply(a,[f,g.length].concat(d))}}}return this.listener},defaultListeners:function(){return{index:[],length:[]}},defaultActions:function(){return["length","index"]},makeEvent:function(a,c){if(!c)return new P.E(a,this.shell,P.E.Types.array,b.setLength,-1,this.shell.length,this.shell.length);var d=c[0],e=c[1],f=c[2],g=c[3];return new P.E(a,this.shell,P.E.Types.array,d,e,f,g)},addCaller:function(a){if(!a)return this.addCaller("index"),void this.addCaller("length");var b=P.currentCaller,c=a.charAt(0).toUpperCase()+a.slice(1),d="last"+c+"Caller",e=this[d];b&&e!==b&&(this.on(a,b),this[d]=b)},updateSplice:function(a,c,d){var e,f=b.splice;if(c&&d&&(0!==c.length||0!==d.length))return c.length===d.length?e="index":d.length&&c.length||(e="length"),this.update(null,e,[f,a,c,d])},updateByDiff:function(a){var b,c,d=P.U.diff(a,this.shell._array);for(b in d)c=d[b],c&&this.updateSplice(b,c.o,c.n);return this},setup:function(){var a,c,d,e,f=this,g=this.shell,h=g._array.length;for(e=0;h>e;e++)this.defineIndexProp(e);a=function(){return f.addCaller("length"),g._array.length},c=function(a){return g._array.length!==a?(d=g._array.length,g._array.length=a,f.update(null,"length",[b.setLength,-1,d,a]),a):void 0},Object.defineProperty(g,"length",{configurable:!1,enumerable:!0,get:a,set:c})},defineIndexProp:function(a){var c,d=this,e=this.shell,f=e._array,g=P.U.isArray,h=P.U.isObject,i=P.U.isFunction;g(f[a])?new P.ArrayProperty(f,a):i(f[a])||null===f[a]||h(f[a])&&(this.isComplex=!0,new P.ObjectProperty(f,a)),Object.defineProperty(e,a,{enumerable:!0,configurable:!0,get:function(){return d.addCaller("index"),f[a]},set:function(e){f[a]!==e&&(c=f[a],f[a]=e,d.update(null,"index",[b.set,a,c,e]))}})}}),k.Array=P.A=a=function(){var a,b;a=0===arguments.length?[]:1===arguments.length&&P.U.isArray(arguments[0])?arguments[0]:A.call(arguments),P.U.defValProp(this,"_array",!1,!1,!0,a),b=new P.AC(this),P.U.defValProp(this,"__pro__",!1,!1,!1,b),P.U.defValProp(this,"core",!1,!1,!1,b),b.prob()},P.U.ex(P.A,{Operations:{set:0,add:1,remove:2,setLength:3,reverse:4,sort:5,splice:6},reFilter:function(a,b,c){var d=b._array;b._array=o.apply(a._array,c),b.core.updateByDiff(d)}}),b=a.Operations,k.Array.prototype=c=P.U.ex(Object.create(l),{constructor:k.Array,concat:function(){var a,b;return 1===arguments.length&&P.U.isProArray(arguments[0])&&(b=arguments[0],arguments[0]=b._array),a=new P.A(m.apply(this._array,arguments)),b?(this.core.on(d.leftConcat(a,this,b)),b.core.on(d.rightConcat(a,this,b))):this.core.on(d.leftConcat(a,this,A.call(arguments,0))),a},every:function(a,b){return this.core.addCaller(),this.core.isComplex&&(a=this.core.actionFunction(a)),n.call(this._array,a,b)},pevery:function(){var a=new P.Val(n.apply(this._array,arguments));return this.core.on(d.every(a,this,arguments)),a},some:function(){return this.core.addCaller(),B.apply(this._array,arguments)},psome:function(){var a=new P.Val(B.apply(this._array,arguments));return this.core.on(d.some(a,this,arguments)),a},forEach:function(){return this.core.addCaller(),p.apply(this._array,arguments)},filter:function(a,b,c){(this.core.isComplex||c)&&(a=this.core.actionFunction(a));var e=new P.A(o.apply(this._array,arguments)),f=d.filter(e,this,arguments);return this.core.on(f),e.core.filteringListener=f,e},map:function(){var a=new P.A(t.apply(this._array,arguments));return this.core.on(d.map(a,this,arguments)),a},reduce:function(){return this.core.addCaller(),w.apply(this._array,arguments)},preduce:function(){var a=new P.Val(w.apply(this._array,arguments));return this.core.on(d.reduce(a,this,arguments)),a},reduceRight:function(){return this.core.addCaller(),x.apply(this._array,arguments)},preduceRight:function(){var a=new P.Val(x.apply(this._array,arguments));return this.core.on(d.reduceRight(a,this,arguments)),a},indexOf:function(){return this.core.addCaller(),q.apply(this._array,arguments)},pindexOf:function(){var a=new P.Val(q.apply(this._array,arguments));return this.core.on(d.indexOf(a,this,arguments)),a},lastIndexOf:function(){return this.core.addCaller(),s.apply(this._array,arguments)},plastindexOf:function(){var a=new P.Val(s.apply(this._array,arguments));return this.core.on(d.lastIndexOf(a,this,arguments)),a},join:function(){return this.core.addCaller(),r.apply(this._array,arguments)},pjoin:function(a){var b=this.preduce(function(b,c){return b+a+c},""),c=new P.Val(function(){return b.v?b.v.substring(1):""});return c},toLocaleString:function(){return this.core.addCaller(),E.apply(this._array,arguments)},toString:function(){return this.core.addCaller(),F.apply(this._array,arguments)},valueOf:function(){return this.toArray()},slice:function(){var a=new P.A(A.apply(this._array,arguments));return this.core.on(d.slice(a,this,arguments)),a},reverse:function(){if(0!==this._array.length){var a=y.apply(this._array,arguments);return this.core.update(null,"index",[b.reverse,-1,null,null]),a}},sort:function(){if(0!==this._array.length){var a=(C.apply(this._array,arguments),arguments);return this.core.update(null,"index",[b.sort,-1,null,a]),this}},splice:function(a,b){var c,d=this._array.length,e=D.apply(this._array,arguments),f=this._array.length,g=A.call(arguments,2);if(a=~a?a:f-a,b=(null==b?f-a:b)||0,g.length>b)for(c=g.length-b;c--;)this.core.defineIndexProp(d++);else if(b>g.length)for(c=b-g.length;c--;)delete this[--d];return this.core.updateSplice(a,e,g),new P.A(e)},pop:function(){if(0!==this._array.length){var a=u.apply(this._array,arguments),c=this._array.length;return delete this[c],this.core.update(null,"length",[b.remove,this._array.length,a,null]),a}},push:function(){var a,c,d=arguments,e=arguments.length;for(a=0;e>a;a++)c=this._array.length,v.call(this._array,arguments[a]),this.core.defineIndexProp(c);return this.core.update(null,"length",[b.add,this._array.length-1,null,A.call(d,0)]),this._array.length},shift:function(){if(0!==this._array.length){var a=z.apply(this._array,arguments),c=this._array.length;return delete this[c],this.core.update(null,"length",[b.remove,0,a,null]),a}},unshift:function(){for(var a,c=A.call(arguments,0),d=arguments.length,e=this._array,a=0;d>a;a++)e.splice(a,0,arguments[a]),this.core.defineIndexProp(e.length-1);
return this.core.update(null,"length",[b.add,0,null,c]),e.length},toArray:function(){var a,b,c=[],d=this._array,e=d.length,f=P.U.isProArray;for(a=0;e>a;a++)b=d[a],f(b)&&(b=b.toArray()),c.push(b);return c},toJSON:function(){return JSON.stringify(this._array)}}),k.Array.Listeners=P.A.L=d={check:function(a){if(a.type!==P.E.Types.array)throw Error("Not implemented for non array events")},leftConcat:function(a,e,f){return function(g){d.check(g);var h,i,j=g.args[0],k=g.args[1],l=g.args[2],n=g.args[3],o=f.length;j===b.set?a[k]=n:j===b.add?(h=A.call(n,0),0===k?c.unshift.apply(a,h):c.splice.apply(a,[a._array.length-o,0].concat(h))):j===b.remove?0===k?c.shift.call(a,l):c.splice.apply(a,[a._array.length-o-1,1]):j===b.setLength?(h=l-n,h>0?c.splice.apply(a,[n,h]):(i=[l,0],i.length=2-h,c.splice.apply(a,i))):j===b.reverse||j===b.sort?(h=a._array,i=P.U.isProArray(f)?f._array:f,a._array.length=0,v.apply(a._array,m.apply(e._array,i)),a.core.updateByDiff(h)):j===b.splice&&c.splice.apply(a,[k,l.length].concat(n))}},rightConcat:function(a,e,f){return function(g){d.check(g);var h,i=g.args[0],j=g.args[1],k=g.args[2],l=g.args[3],n=e._array.length;i===b.set?a[n+j]=l:i===b.add?0===j?c.splice.apply(a,[n,0].concat(l)):c.push.apply(a,l):i===b.remove?0===j?c.splice.call(a,n,1):c.pop.call(a,k):i===b.setLength?a.length=n+l:i===b.reverse||i===b.sort?(h=a._array,a._array.length=0,v.apply(a._array,m.apply(e._array,f._array)),a.core.updateByDiff(h)):i===b.splice&&c.splice.apply(a,[j+n,k.length].concat(l))}},every:function(a,c,e){var f=e[0],g=e[1];return function(h){d.check(h);var i,j=h.args[0],k=(h.args[1],h.args[2]),l=h.args[3];j===b.set?(i=f.call(g,l),a.valueOf()!==!0||i?a.valueOf()===!1&&i&&(a.v=n.apply(c._array,e)):a.v=!1):j===b.add?a.valueOf()===!0&&(a.v=n.call(l,f,g)):j===b.remove?a.valueOf()!==!1||f.call(g,k)||(a.v=n.apply(c._array,e)):j===b.setLength?a.valueOf()===!1&&(a.v=n.apply(c._array,e)):j===b.splice&&(a.valueOf()===!0?a.v=n.call(l,f,g):n.call(l,f,g)&&!n.call(k,f,g)&&(a.v=n.apply(c._array,e)))}},some:function(a,c,e){var f=e[0],g=e[1];return function(h){d.check(h);var i,j=h.args[0],k=(h.args[1],h.args[2]),l=h.args[3];j===b.set?(i=f.call(g,l),a.valueOf()===!1&&i?a.v=!0:a.valueOf()!==!0||i||(a.v=B.apply(c._array,e))):j===b.add?a.valueOf()===!1&&(a.v=B.call(l,f,g)):j===b.remove?a.valueOf()===!0&&f.call(g,k)&&(a.v=B.apply(c._array,e)):j===b.setLength?a.valueOf()===!0&&(a.v=B.apply(c._array,e)):j===b.splice&&(a.valueOf()===!1?a.v=B.call(l,f,g):B.call(k,f,g)&&!B.call(l,f,g)&&(a.v=B.apply(c._array,e)))}},filter:function(e,f,g){var h=g[0],i=g[1];return function(j){if(P.U.isFunction(j))return g[0]=h=j,void a.reFilter(f,e,g);d.check(j);var k,l,m,n,o,p,q=j.args[0],r=j.args[1],s=j.args[2],t=j.args[3];if(q===b.set)k=h.call(i,t),l=h.call(i,s),(l===!0||k===!0)&&a.reFilter(f,e,g);else if(q===b.add)if(n=[],m=A.call(t,0),p=m.length,0===r){for(o=p-1;o>=0;)h.apply(i,[m[o],o,f._array])&&n.unshift(m[o]),o--;n.length&&c.unshift.apply(e,n)}else{for(o=0;p>o;)h.apply(i,[m[o],f._array.length-(p-o),f._array])&&n.push(m[o]),o++;n.length&&c.push.apply(e,n)}else q===b.remove?h.apply(i,[s,r,f._array])&&(0===r?e.shift():e.pop()):q===b.setLength?a.reFilter(f,e,g):q===b.reverse?e.reverse():q===b.sort?c.sort.apply(e,t):q===b.splice&&a.reFilter(f,e,g)}},map:function(a,e,f){var g=f[0],h=f[1];return function(f){d.check(f);var i,j,k,l,m=f.args[0],n=f.args[1],o=f.args[2],p=f.args[3];if(m===b.set)a[n]=g.call(h,p);else if(m===b.add)if(l=[],i=A.call(p,0),k=i.length,0===n){for(j=k-1;j>=0;)l[j]=g.apply(h,[i[j],j,e._array]),j--;c.unshift.apply(a,l)}else{for(j=0;k>j;)l[j]=g.apply(h,[i[j],e._array.length-(k-j),e._array]),j++;c.push.apply(a,l)}else if(m===b.remove)0===n?a.shift():a.pop();else if(m===b.setLength)a.length=p;else if(m===b.reverse)a.reverse();else if(m===b.sort)c.sort.apply(a,p);else if(m===b.splice){for(l=[],j=0;j<p.length;)l[j]=g.apply(h,[p[j],j+n,e._array]),j++;c.splice.apply(a,[n,o.length].concat(l))}}},reduce:function(a,c,e){var f=c._array.length,g=e[0];return function(h){d.check(h);var i=h.args[0],j=h.args[1],k=h.args[2],l=h.args[3];a.v=i===b.add&&0!==j||i===b.splice&&j>=f&&0===k.length?w.apply(l,[g,a.valueOf()]):w.apply(c._array,e),f=c._array.length}},reduceRight:function(a,c,e){var f=e[0];return function(g){d.check(g);var h=g.args[0],i=g.args[1],j=g.args[2],k=g.args[3];a.v=h===b.add&&0===i||h===b.splice&&0===i&&0===j.length?x.apply(k,[f,a.valueOf()]):x.apply(c._array,e)}},indexOf:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k,l=i.args[0],m=i.args[1],n=i.args[2],o=i.args[3],p=a.valueOf();l===b.set?n===f?a.v=q.apply(c._array,e):o===f&&(p>m||-1===p)&&(!h||m>=g)&&(a.v=m):l===b.add?(j=o.indexOf(f),0===m?-1!==j&&(!h||m>=g)?a.v=j:-1!==p&&(a.v=p+o.length):-1===p&&(!h||m>=g)&&-1!==j&&(a.v=m)):l===b.remove?-1!==p&&(0===m?a.v=n!==f||h?p-1:q.apply(c._array,e):f===n&&(a.v=-1)):l===b.setLength&&p>=o?a.v=-1:l===b.reverse||l===b.sort?a.v=q.apply(c._array,e):l===b.splice&&(j=o.indexOf(f),k=j+m,p>=m?-1!==j&&p>k&&(!h||k>=g)?a.v=k:o.length!==n.length&&-1===n.indexOf(f)?(p+=o.length-n.length,a.v=!h||p>=g?p:q.apply(c._array,e)):a.v=q.apply(c._array,e):-1===p&&-1!==j&&(a.v=k))}},lastIndexOf:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k=i.args[0],l=i.args[1],m=i.args[2],n=i.args[3],o=a.valueOf();k===b.set?m===f?a.v=s.apply(c._array,e):n===f&&(l>o||-1===o)&&(!h||g>=l)&&(a.v=l):k===b.add?(j=n.indexOf(f),0===l?-1!==j&&-1===o&&(!h||g>=l)?a.v=j:-1!==o&&(a.v=o+n.length):-1!==j&&(!h||g>=l+j)&&(a.v=l+j)):k===b.remove?-1!==o&&(0===l?a.v=o-1:f===m&&(a.v=s.apply(c._array,e))):(k===b.splice||k===b.reverse||k===b.sort||k===b.setLength&&m>n)&&(a.v=s.apply(c._array,e))}},slice:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k=i.args[0],l=i.args[1],m=(i.args[2],i.args[3]);k===b.set?l>=f&&(!h||g>l)&&(a[l-f]=m):(j=a._array,a._array.length=0,v.apply(a._array,A.apply(c._array,e)),a.core.updateByDiff(j))}}},k.Val=P.V=function(a,b){this.v=a,b&&(P.U.isString(b)||P.U.isArray(b))&&(b={v:b}),P.prob(this,b)},k.Val.prototype=P.U.ex(Object.create(P.Observable.prototype),{constructor:k.Val,type:function(){return this.__pro__.properties.v.type()},on:function(a,b){return this.__pro__.properties.v.on(a,b),this},off:function(a,b){return this.__pro__.properties.v.off(a,b),this},onErr:function(a){return this.__pro__.properties.v.onErr(a),this},offErr:function(a){return this.__pro__.properties.v.offErr(a),this},transform:function(a){return this.__pro__.properties.v.transform(a),this},into:function(){return this.__pro__.properties.v.into.apply(this.__pro__.properties.v,arguments),this},out:function(a){return this.__pro__.properties.v.out(a),this},update:function(a,b,c){return this.__pro__.properties.v.update(a,b,c),this},willUpdate:function(a,b,c){return this.__pro__.properties.v.willUpdate(a,b,c),this},valueOf:function(){return this.__pro__.properties.v.val},toString:function(){return this.valueOf().toString()}}),k.prob=function(a,b){var c,d=P.U.isArray;return null===a||!P.U.isObject(a)&&!d(a)?new P.V(a,b):P.U.isArray(a)?new P.A(a):(c=new P.OC(a,b),P.U.defValProp(a,"__pro__",!1,!1,!1,c),c.prob(),a)},k.proxy=function(a,b,c,d){if(!a||!b)return null;P.U.isProObject(b)||(b=k.prob(b,d)),c&&P.U.isObject(c)||(c={});var e,f=b.__pro__.properties;for(e in f)a.hasOwnProperty(e)||(a[e]=null,c[e]=f[e]);return a=k.prob(a,c)},k.Registry=P.R=function(){this.providers={}},k.Registry.prototype=e={constructor:k.Registry,register:function(a,b){if(this.providers[a])throw new Error(a+"is already registered in this registry.");return this.providers[a]=b,b.registered&&b.registered(this),this},getProviderByName:function(a){var b=a.split(":");return[this.providers[b[0]],b[1],b.slice(2)]},setup:function(a,b,c){return f.run.apply(null,[a,b,this].concat(c))},make:function(a,b){var c,d=A.call(arguments,2),e=this.getProviderByName(a);return e[0]?(c=e[0].make.apply(e[0],[e[1],e[2]].concat(d)),this.setup(c,b,d)):null},store:function(a,b){var c=A.call(arguments,2),d=this.getProviderByName(a);return d[0]?d[0].store.apply(d[0],[d[1],b,d[2]].concat(c)):null},get:function(a){var b=this.getProviderByName(a);return b[0]?b[0].get(b[1]):null},toObjectArray:function(a){var b=this;return P.U.isArray(a)?t.call(a,function(a){return b.toObject(a)}):this.toObject(a)},toObject:function(a){if(P.U.isString(a)){var b=this.get(a);return b?b:a}return a}},k.OpStore={all:{simpleOp:function(a,b){return{sym:b,match:function(a){return a.substring(0,b.length)===b},toOptions:function(b,c){var d,e,h,i,j=new RegExp(g[a].sym+"(\\w*)\\(([\\s\\S]*)\\)"),k=j.exec(c),l=k[1],m=k[2],n=[],o=A.call(arguments,2),p=f.predefined[a];if(l&&n.push(l),m)for(m=m.split(","),h=m.length,e=0;h>e;e++)d=m[e].trim(),"$"===d.charAt(0)?d=o[parseInt(d.substring(1),10)-1]:p&&"&"===d.charAt(0)?(e=d.lastIndexOf("&"),i=d.substring(0,e),p[i]&&(d=p[i].call(null,d.substring(e+1)))):p&&p[d]&&(d=p[d],P.U.isArray(d)&&(n=n.concat(d),d=void 0)),void 0!==d&&n.push(d);b[a]?P.U.isArray(b[a][0])?b[a].push(n):b[a]=[b[a],n]:b[a]=n,b.order=b.order||[],b.order.push(a)},action:function(b,c){if(!c||!c[a])return b;var d=c[a];return P.U.isArray(d)||(d=[d]),b[a].apply(b,d)}}}}},h=P.OpStore.all,k.DSL={separator:"|",ops:{into:h.simpleOp("into","<<"),out:h.simpleOp("out",">>"),on:h.simpleOp("on","@"),mapping:h.simpleOp("mapping","map"),filtering:h.simpleOp("filtering","filter"),accumulation:h.simpleOp("accumulation","acc")},predefined:{mapping:{"-":function(a){return-a},pow:function(a){return a*a},sqrt:function(a){return Math.sqrt(a)},"int":function(a){return parseInt(a,10)},"&.":function(a){return function(b){var c=b[a];return c?P.U.isFunction(c)?c.call(b):c:b}},pop:function(){return P.E.simple("array","pop")},shift:function(){return P.E.simple("array","shift")},eventToVal:function(a){return a.args[0][a.target]},"true":function(){return!0}},filtering:{odd:function(a){return a%2!==0},even:function(a){return a%2===0},"+":function(a){return a>=0},"-":function(a){return 0>=a},defined:function(a){return void 0!==a.args[0][a.target]},originalEvent:function(a){return void 0===a.source||null===a.source}},accumulation:{"+":[0,function(a,b){return a+b}],"*":[1,function(a,b){return a*b}],"+str":["",function(a,b){return a+b}]}},defPredefined:function(a,b,c){("m"===a||"map"===a)&&(a="mapping"),("f"===a||"filter"===a)&&(a="filtering"),("a"===a||"acc"===a||"accumulate"===a)&&(a="accumulation"),k.DSL.predefined[a][b]=c},optionsFromString:function(a){return f.optionsFromArray.apply(null,[a.split(f.separator)].concat(A.call(arguments,1)))},optionsFromArray:function(a){{var b,c,d,e={},f=a.length;P.R.ops}for(b=0;f>b;b++){c=a[b];for(d in P.DSL.ops)if(d=P.DSL.ops[d],d.match(c)){d.toOptions.apply(d,[e,c].concat(A.call(arguments,1)));break}}return e},run:function(a,b,c){var d,e,h,i,j,k=P.U.isString,l=A.call(arguments,3),m={};if(b&&k(b)&&(b=f.optionsFromString.apply(null,[b].concat(l))),b&&b instanceof P.Observable&&(b={into:b}),b&&b.order)for(h=b.order.length,e=0;h>e;e++)d=b.order[e],(i=g[d])&&(c&&(b.order.indexOf(d)!==b.order.lastIndexOf(d)&&(void 0===m[d]&&(m[d]=-1),m[d]=m[d]+1,j=b[d],b[d]=b[d][m[d]]),b[d]=c.toObjectArray(b[d])),i.action(a,b),j?(b[d]=j,j=void 0,m[d]>=b[d].length-1&&delete b[d]):delete b[d]);for(i in g)b&&(d=b[i])&&(b[i]=c.toObjectArray(d)),i=g[i],i.action(a,b);return a}},f=P.DSL,g=f.ops,P.U.ex(k.Registry,{Provider:function(){this.stored={}},StreamProvider:function(){P.R.Provider.call(this)},FunctionProvider:function(){P.R.Provider.call(this)},ProObjectProvider:function(){P.R.Provider.call(this)}}),k.Registry.Provider.prototype={constructor:k.Registry.Provider,make:function(a){var b,c=A.call(arguments,1);return this.stored[a]=b=this.provide.apply(this,c),b},store:function(a,b){return this.stored[a]=b},get:function(a){return this.stored[a]},del:function(a){var b=this.get(a);return delete this.stored[a],b},registered:function(){},types:{basic:function(){throw new Error("Abstract: implement!")}},provide:function(a){if(a){var b,c,d,e=a[0],f=A.call(arguments,1);if(e&&(b=new RegExp("(\\w*)\\(([\\s\\S]*)\\)"),c=b.exec(e),d=c[2],d&&(d=d.split(",")),e=c[1],e&&this.types[e]))return this.types[e].apply(this,[d].concat(f))}return this.types.basic.apply(this,arguments)}},k.Registry.StreamProvider.prototype=P.U.ex(Object.create(P.R.Provider.prototype),{constructor:k.Registry.StreamProvider,registered:function(a){a.s=a.stream=P.U.bind(this,this.get)},types:{basic:function(){return new P.S},delayed:function(a){return new P.DBS(parseInt(a[0],10))},size:function(a){return new P.SBS(parseInt(a[0],10))},debouncing:function(a){return new P.DDS(parseInt(a[0],10))},throttling:function(a){return new P.TDS(parseInt(a[0],10))}}}),k.Registry.FunctionProvider.prototype=P.U.ex(Object.create(P.R.Provider.prototype),{constructor:k.Registry.FunctionProvider}),k.Registry.ProObjectProvider.prototype=P.U.ex(Object.create(P.R.Provider.prototype),{constructor:k.Registry.ProObjectProvider,registered:function(a){a.po=a.proObject=P.U.bind(this,this.get),a.prob=P.U.bind(this,function(a,b,c){return this.make(a,null,b,c)})},types:{basic:function(a,b,c){return P.prob(b,c)}}}),i=new P.R.StreamProvider,j=new P.R.FunctionProvider,proObjectProvider=new P.R.ProObjectProvider,k.registry=(new P.R).register("s",i).register("po",proObjectProvider).register("obj",proObjectProvider).register("f",j).register("l",j),Pro});