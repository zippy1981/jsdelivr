(function(q){"object"===typeof exports&&"undefined"!==typeof module?module.exports=q():"function"===typeof define&&define.amd?define([],q):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).algoliasearchHelper=q()})(function(){return function n(h,k,e){function d(b,c){if(!k[b]){if(!h[b]){var g="function"==typeof require&&require;if(!c&&g)return g(b,!0);if(a)return a(b,!0);g=Error("Cannot find module '"+b+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=k[b]={exports:{}};h[b][0].call(g.exports,function(a){var c=h[b][1][a];return d(c?c:a)},g,g.exports,n,h,k,e)}return k[b].exports}for(var a="function"==typeof require&&require,c=0;c<e.length;c++)d(e[c]);return d}({1:[function(n,h,k){var e=n("./src/algoliasearch.helper");h.exports=function(d,a,c){return new e(d,a,c)}},{"./src/algoliasearch.helper":2}],2:[function(n,h,k){function e(a,c,b){b=d({},e.optionsDefaults,b);this.client=a;this.index=c;this.options=b;this.page=0;this.refinements={};this.excludes=
{};this.disjunctiveRefinements={};this.extraQueries=[]}var d=n("./functions/extend");e.optionsDefaults={facets:[],disjunctiveFacets:[],hitsPerPage:20,defaultFacetFilters:[]};e.prototype={constructor:e,search:function(a,c,b){if("function"===typeof b){var e=b;b=c;c=e}this.q=a;this.searchCallback=c;this.searchParams=b||{};this.page=this.page||0;this.refinements=this.refinements||{};this.disjunctiveRefinements=this.disjunctiveRefinements||{};this._search()},clearRefinements:function(){this.disjunctiveRefinements=
{};this.refinements={}},addDisjunctiveRefine:function(a,c){this.disjunctiveRefinements=this.disjunctiveRefinements||{};this.disjunctiveRefinements[a]=this.disjunctiveRefinements[a]||{};this.disjunctiveRefinements[a][c]=!0},removeDisjunctiveRefine:function(a,c){this.disjunctiveRefinements=this.disjunctiveRefinements||{};this.disjunctiveRefinements[a]=this.disjunctiveRefinements[a]||{};try{delete this.disjunctiveRefinements[a][c]}catch(b){this.disjunctiveRefinements[a][c]=void 0}},addRefine:function(a,
c){this.refinements=this.refinements||{};this.refinements[a+":"+c]=!0},removeRefine:function(a,c){this.refinements=this.refinements||{};this.refinements[a+":"+c]=!1},addExclude:function(a,c){this.excludes=this.excludes||{};this.excludes[a+":-"+c]=!0},removeExclude:function(a,c){this.excludes=this.excludes||{};this.excludes[a+":-"+c]=!1},toggleExclude:function(a,c){for(var b=0;b<this.options.facets.length;++b)if(this.options.facets[b]===a)return b=a+":-"+c,this.excludes[b]=!this.excludes[b],this.page=
0,this._search(),!0;return!1},toggleRefine:function(a,c){for(var b=0;b<this.options.facets.length;++b)if(this.options.facets[b]===a)return b=a+":"+c,this.refinements[b]=!this.refinements[b],this.page=0,this._search(),!0;this.disjunctiveRefinements[a]=this.disjunctiveRefinements[a]||{};for(b=0;b<this.options.disjunctiveFacets.length;++b)if(this.options.disjunctiveFacets[b]===a)return this.disjunctiveRefinements[a][c]=!this.disjunctiveRefinements[a][c],this.page=0,this._search(),!0;return!1},isRefined:function(a,
c){return this.refinements[a+":"+c]||this.disjunctiveRefinements[a]&&this.disjunctiveRefinements[a][c]},isExcluded:function(a,c){return!!this.excludes[a+":-"+c]},nextPage:function(){this._gotoPage(this.page+1)},previousPage:function(){0<this.page&&this._gotoPage(this.page-1)},gotoPage:function(a){this._gotoPage(a)},setPage:function(a){this.page=a},setIndex:function(a){this.index=a},getIndex:function(){return this.index},clearExtraQueries:function(){this.extraQueries=[]},addExtraQuery:function(a,c,
b){this.extraQueries.push({index:a,query:c,params:b||{}})},_gotoPage:function(a){this.page=a;this._search()},_search:function(){this.client.startQueriesBatch();this.client.addQueryInBatch(this.index,this.q,this._getHitsSearchParams());for(var a=[],c={},b=0,b=0;b<this.options.disjunctiveFacets.length;++b){var e=this.options.disjunctiveFacets[b];this._hasDisjunctiveRefinements(e)?a.push(e):c[e]=!0}for(b=0;b<a.length;++b)this.client.addQueryInBatch(this.index,this.q,this._getDisjunctiveFacetSearchParams(a[b]));
for(b=0;b<this.extraQueries.length;++b)this.client.addQueryInBatch(this.extraQueries[b].index,this.extraQueries[b].query,this.extraQueries[b].params);var g=this;this.client.sendQueriesBatch(function(e,d){if(e)g.searchCallback(Error(d.message),d);else{var f=d.results[0];f.disjunctiveFacets=f.disjunctiveFacets||{};f.facetStats=f.facetStats||{};for(var m in c)if(f.facets[m]&&!f.disjunctiveFacets[m]){f.disjunctiveFacets[m]=f.facets[m];try{delete f.facets[m]}catch(h){f.facets[m]=void 0}}for(b=0;b<a.length;++b){for(var l in d.results[b+
1].facets)if(f.disjunctiveFacets[l]=d.results[b+1].facets[l],g.disjunctiveRefinements[l])for(var k in g.disjunctiveRefinements[l])!f.disjunctiveFacets[l][k]&&g.disjunctiveRefinements[l][k]&&(f.disjunctiveFacets[l][k]=0);for(var n in d.results[b+1].facets_stats)f.facetStats[n]=d.results[b+1].facets_stats[n]}for(var p in g.excludes)g.excludes[p]&&(l=p.indexOf(":-"),m=p.slice(0,l),l=p.slice(l+2),f.facets[m]=f.facets[m]||{},f.facets[m][l]||(f.facets[m][l]=0));if(0!==g.extraQueries.length)for(f={results:[f]},
b=0;b<g.extraQueries.length;++b)f.results.push(d.results[1+a.length+b]);g.searchCallback(null,f)}})},_getHitsSearchParams:function(){for(var a=[],c=0,c=0;c<this.options.facets.length;++c)a.push(this.options.facets[c]);for(c=0;c<this.options.disjunctiveFacets.length;++c){var b=this.options.disjunctiveFacets[c];this._hasDisjunctiveRefinements(b)||a.push(b)}return d({},{hitsPerPage:this.options.hitsPerPage,page:this.page,facets:a,facetFilters:this._getFacetFilters()},this.searchParams)},_getDisjunctiveFacetSearchParams:function(a){return d({},
this.searchParams,{hitsPerPage:1,page:0,attributesToRetrieve:[],attributesToHighlight:[],attributesToSnippet:[],facets:a,facetFilters:this._getFacetFilters(a)})},_hasDisjunctiveRefinements:function(a){for(var c in this.disjunctiveRefinements[a])if(this.disjunctiveRefinements[a][c])return!0;return!1},_getFacetFilters:function(a){var c=[];if(this.options.defaultFacetFilters)for(var b=0;b<this.options.defaultFacetFilters.length;++b)c.push(this.options.defaultFacetFilters[b]);for(var d in this.refinements)this.refinements[d]&&
c.push(d);for(var e in this.excludes)this.excludes[e]&&c.push(e);for(var h in this.disjunctiveRefinements)if(h!==a){var b=[],k;for(k in this.disjunctiveRefinements[h])this.disjunctiveRefinements[h][k]&&b.push(h+":"+k);0<b.length&&c.push(b)}return c}};h.exports=e},{"./functions/extend":3}],3:[function(n,h,k){h.exports=function(e){e=e||{};for(var d=1;d<arguments.length;d++)if(arguments[d])for(var a in arguments[d])arguments[d].hasOwnProperty(a)&&(e[a]=arguments[d][a]);return e}},{}]},{},[1])(1)});
