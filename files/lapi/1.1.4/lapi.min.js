var lapi={};(function(){lapi.CONSTANTS={};lapi.CONSTANTS.CONSOLE_MSGS={IMMUTABLE:"cannot change this"};lapi.CONSTANTS.SCENE={LIGHT:"LightID",CAMERA:"CameraID",MESH:"MeshID",MATERIAL:"MaterialID",TEXTURE:"TextureID",GROUP:"GroupID",PROJECTION:"TextureProjectionID",STATES:"SceneStateID"};lapi._cbStack=0;lapi._cbmap={};lapi._eventCbMap={};lapi._lagoaUrl="http://lagoa.com";lapi._user_id=24;lapi._project_id;lapi._assetGuid;lapi._objData={};lapi._sceneTimer;lapi.onObjectAdded=function(){};lapi.checkGuidToolCB=function(){};lapi.onFirstFrame=function(){};window.addEventListener("message",function(e){var retval=JSON.parse(e.data);if(retval.channel=="rpcend"){if(retval.subchannel){var subchannel=retval.subchannel;if(subchannel==="objectAdded"){var scn=lapi.getActiveScene();var tuid=retval.data.tuid;var pset=retval.data.pset;scn.addObject(tuid,retval.data.guid,pset,function(obj){var guid=obj.properties.getParameter("guid").value;if(lapi._cbmap[guid]){var callback=lapi._cbmap[guid];callback(obj);delete lapi._cbmap[guid]}lapi.onObjectAdded(obj)})}else if(subchannel==="firstFrame"){lapi.onFirstFrame()}else if(subchannel==="checkGuid"){lapi.checkGuidToolCB(retval.data)}}else{if(lapi._cbmap[retval.id]){var callback=lapi._cbmap[retval.id];callback(retval);delete lapi._cbmap[retval.id]}else if(lapi._eventCbMap[retval.id]){var cbArray=lapi._eventCbMap[retval.id];for(var i=0;i<cbArray.length;++i){cbArray[i](retval.data)}}}}});lapi._activeCamera=null;lapi._isRendering=false;lapi._isPlaying=false;lapi._timeIntervalId=null;lapi._frame=0;lapi._generateRandomString=function(){return"xxxxxxxxxx".replace(/x/g,function(){return Math.floor(Math.random()*16).toString(16)})};lapi._generateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};lapi._messageIframe=function(in_message){var iframe=document.getElementById("lagoaframe");iframe.contentWindow.postMessage(JSON.stringify(in_message),"*")};lapi._embedRPC=function(message,callback,params){var randName=lapi._generateRandomString();params=params||undefined;if(callback){lapi._cbmap[randName]=callback}lapi._messageIframe({channel:"embedrpc",id:randName,command:message,params:params})};lapi._activeScene=null;lapi.getActiveScene=function(){return lapi._activeScene};lapi._initialize=function(){var self=this;lapi._embedRPC("var classedItems = ACTIVEAPP.GetClassedItems();"+"var sceneKeys = {};"+"for( var i in classedItems ){ "+" sceneKeys[i] = Object.keys( classedItems[i] );"+"};"+"sceneKeys;",function(e){var sceneGuid=e.data["SceneID"][0];var classedItems=e.data;delete classedItems["SceneID"];self._activeScene=new lapi.Scene(sceneGuid,classedItems,function(){var cams=self._activeScene.getCameras();self._activeCamera=cams[0];setTimeout(lapi.onSceneLoaded,500)})})};lapi._loadAssets=function(in_assetArray,in_cb){in_cb=in_cb||null;lapi._embedRPC("loadAssets",in_cb,in_assetArray)};var BACKEND_DELAY_SHORT=3e3;var BACKEND_DELAY_LONG=6e3;lapi._backEndJob=function(in_command,in_params,in_delay,in_readyCb,in_cb){in_cb=in_cb||null;in_readyCb=in_readyCb||null;in_params=in_params||undefined;in_delay=in_delay||BACKEND_DELAY_LONG;var pollDelay=null;if(in_delay>BACKEND_DELAY_LONG){pollDelay=BACKEND_DELAY_LONG}else{pollDelay=in_delay}lapi._embedRPC(in_command,function(in_response){if(in_response.error){console.error(in_command+": "+in_response.error);return}var guid=null;var path="";var args="";if(in_response.data.newScene){path="/assets/";args="?versions=true";guid=in_response.data.asset_guid}else{path="/versions/";guid=in_response.data.version_guid}if(in_cb){var initTimer=null;var timer=null;var cb=function(){var _cb=function(reply){if(!reply.errors){if(in_readyCb&&!in_readyCb(reply)){return}else{clearInterval(timer);timer=null;in_cb(reply)}}};$.get(lapi._lagoaUrl+path+guid+".json"+args,_cb,"jsonp")};var fireCb=function(){clearTimeout(initTimer);initTimer=null;timer=setInterval(cb,pollDelay)};initTimer=setTimeout(fireCb,in_delay)}},in_params)};lapi.saveRender=function(in_params,in_cb){var _ready=function(data){if(data.downloadable_formats.length){return true}return false};lapi._backEndJob("saveRender",in_params,BACKEND_DELAY_SHORT,_ready,in_cb)};lapi.saveScene=function(in_params,in_cb){lapi._backEndJob("saveScene",in_params,BACKEND_DELAY_SHORT,null,in_cb)};lapi.startBackgroundRender=function(in_params,in_cb){var delay=1;if(in_params){delay=delay||in_params.duration}delay*=6e4;var _ready=function(data){if(data.downloadable_formats.length){return true}return false};lapi._backEndJob("startBackgroundRender",in_params,delay,_ready,in_cb)};lapi.fetchScene=function(in_cb){lapi._embedRPC("compressScene",function(in_response){if(in_cb){in_cb(in_response.data)}})};lapi.fetchAssets=function(in_params,in_cb){in_params=in_params||{};$.ajax({url:lapi._lagoaUrl+"/users/current_user.json",type:"GET",success:function(data){var user="";if(data.id){user="current_user_id="+data.id}var tags="";var projects="";var query="";var datatypes="";if(in_params.tags){var union="";if(in_params.match){union="&union_tag=true&"}tags=union+"tags="+in_params.tags.join()}if(in_params.projects){projects="&project_ids="+in_params.projects.join()}if(in_params.datatypes){datatypes="&datatype_ids="+in_params.datatypes.join()}if(in_params.query){query="&query="+in_params.query}var searchStr=lapi._lagoaUrl+"/search/assets.json?"+user+tags+projects+datatypes+query+"&sort_updated_at=true";if(in_params.max){$.get(searchStr+"&per_page="+in_params.max+"&page=1",in_cb,"jsonp");return}searchStr+="&per_page=25&page=";var assets=[];var page=0;var accum=function(idx,res){res=res||[];var len=res.length;if(!len&&idx!==0){in_cb(assets);return}if(len){for(var i=0;i<len;++i){assets.push(res[i])}}++idx;$.get(searchStr+idx,accum.bind(null,idx),"jsonp")};accum(0)},dataType:"jsonp"})};lapi.fetchAssetsByTags=function(in_match,in_tags,in_cb){console.warn("Deprecated - Please use fetchAssets instead");lapi.fetchAssets({tags:in_tags,match:in_match},in_cb)};lapi.setObjectParameter=function(in_GUID,in_property,in_values){if(!(in_property instanceof Array)){in_property=[in_property]}var list=[];for(var v in in_values){var paramValue=in_values[v];if(typeof paramValue!=="string"){list.push("{ parameter : prop.getParameter('"+v+"'), value : "+paramValue+"}")}else{list.push("{ parameter : prop.getParameter('"+v+"'), value : '"+paramValue+"'}")}}lapi._embedRPC("var obj = ACTIVEAPP.getScene().GetByGUID('"+in_GUID+"');"+"var prop = obj.PropertySet.getProperty('"+in_property.join("').getProperty('")+"');"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : obj, list : "+"["+list.join()+"]}"+", mutebackend : false, forcedirty : true });")};lapi._runCommand=function(in_string){lapi._embedRPC("ACTIVEAPP.runCommand('"+in_string+"')")};lapi.showToolbar=function(in_enable){var str="";if(in_enable){str="ACTIVEAPP.toolbar.show();"}else{str="ACTIVEAPP.toolbar.hide();"}lapi._embedRPC(str)};lapi.desselectAll=function(){lapi._runCommand("DesselectAll")};lapi.applyMaterialToObjectByGuid=function(in_materialGuid,in_meshGuid){var scn=lapi.getActiveScene();var mesh=scn.getObjectByGuid(in_meshGuid);var mat=scn.getObjectByGuid(in_materialGuid);var matParam=mesh.properties.getProperty("Materials").getParameter("tmaterial");matParam.value=mat.properties.getParameter("guid").value};lapi.applyMaterialToMeshByName=function(in_materialName,in_meshName){var scn=lapi.getActiveScene();var mesh=scn.getObjectByName(in_meshName)[0];var mat=scn.getObjectByName(in_materialName)[0];var matParam=mesh.properties.getProperty("Materials").getParameter("tmaterial");matParam.value=mat.properties.getParameter("guid").value};lapi.isRendering=function(){return this._isRendering};lapi.startRender=function(){this._isRendering=true;lapi._embedRPC("ACTIVEAPP.StartRender()")};lapi.stopRender=function(){this._isRendering=false;lapi._embedRPC("ACTIVEAPP.StopRender()")};lapi.getCamera=function(){return this._activeCamera};lapi.setCameraResolution=function(in_Params){var cam=lapi.getCamera();var camGuid=cam.properties.getParameter("guid").value;var resProp=cam.getProperty("Resolution");in_Params.width="width"in in_Params?in_Params.width:resProp.parameters.width.value;in_Params.height="height"in in_Params?in_Params.height:resProp.parameters.height.value;lapi.setObjectParameter(camGuid,"Resolution",{width:in_Params.width,height:in_Params.height})};lapi.isPlaying=function(){return this._isPlaying};lapi.stop=function(){this._isPlaying=false;this._frame=0};lapi.play=function(in_fps){in_fps=Math.round(1e3/in_fps)||Math.round(1e3/30);if(this.isPlaying())return;var start=null;var self=this;self._timeIntervalId=null;self._isPlaying=true;function doStep(){++self._frame;if(self.isPlaying()){self.stepCb(self._frame)}else{clearInterval(self._timeIntervalId)}}var intervalId=setInterval(doStep,in_fps)};lapi.nextFrame=function(){++this._frame;this.stepCb(this._frame)};lapi.pause=function(){if(this.isPlaying()){clearInterval(this._timeIntervalId);this._timeIntervalId=null}};lapi._activeTool=function(in_tool){lapi._embedRPC("ACTIVEAPP.getToolManager().setActiveTool('"+in_tool+"');")};lapi.moveTool=function(){lapi._activeTool("MoveTool")};lapi.scaleTool=function(){lapi._activeTool("ScaleTool")};lapi.rotateTool=function(){lapi._activeTool("RotationTool")};lapi.orbitTool=function(){lapi._activeTool("OrbitTool")};lapi.panTool=function(){lapi._activeTool("PanTool")};lapi.checkGuidTool=function(){lapi._activeTool("CheckGuidTool")};lapi.enableMouseInteractions=function(in_enable){var action;if(in_enable){action="appendBinding"}else{action="removeBinding"}lapi._embedRPC("ACTIVEAPP.vpman.leafWalk(function (v) {"+"if ( (v instanceof Application.Viewport)) {"+"v."+action+"({"+"event : 'wheel',"+"callback : v._onWheel"+"});"+"}"+"});")};lapi.onSceneLoaded=function(){};lapi.stepCb=function(){};$(function(){function checkLoaded(){lapi._embedRPC("ACTIVEAPP.getSceneLoaded();",function(in_response){if(in_response.data===true){clearInterval(timer);lapi._initialize()}})}var timer=setInterval(checkLoaded,500)})})();lapi.Property=function(in_name){this._parameters={};this._parametersByName={};this._properties={};this._name=in_name;this._parent=null};lapi.Property.prototype={constructor:lapi.Property,getParameter:function(in_param_id){return this.parameters[in_param_id]},addParameter:function(in_parameter){this.parameters[in_parameter.id]=in_parameter;this._parametersByName[in_parameter.name]=in_parameter},appendProperty:function(in_property){in_property._parent=this;this.properties[in_property.name]=in_property},getProperty:function(in_property_name){return this.properties[in_property_name]},get name(){return this._name},set name(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)},get parent(){return this._parent},set parent(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)},get parameters(){return this._parameters},set parameters(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)},get properties(){return this._properties},set properties(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)}};lapi.Parameter=function(in_ctxtObject,in_parentProperty,in_params){var _name=in_params.name||"";var _value=in_params.value||null;var _type=in_params.type||null;var _parent=in_parentProperty||null;var _contextObject=in_ctxtObject||null;var _id=in_params.id||null;this.__defineGetter__("name",function(){return _name});this.__defineSetter__("name",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});this.__defineGetter__("type",function(){return _type});this.__defineSetter__("type",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});this.__defineGetter__("parent",function(){return _parent});this.__defineSetter__("parent",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});this.__defineGetter__("value",function(){return _value});this.__defineGetter__("id",function(){return _id});this.__defineSetter__("id",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});this.__defineSetter__("value",function(in_val){_value=in_val;var paramList={};paramList[this.id]=this.value;var parentPropHierarchy=[];var parent=this.parent;while(parent&&parent.name!=="PropertySet"){parentPropHierarchy.push(parent.name);parent=parent.parent}parentPropHierarchy.reverse();lapi.setObjectParameter(_contextObject.properties.getParameter("guid").value,parentPropHierarchy,paramList)});this._setValueMuted=function(in_val){_value=in_val}};lapi.Parameter.prototype={constructor:lapi.Parameter};lapi.SceneObject=function(in_guid,in_pset,in_cb){var _guid=in_guid;var _properties={};var _self=this;this._copiedCount=0;in_pset=in_pset||undefined;in_cb=in_cb||undefined;this.__defineGetter__("properties",function(){return _properties});this.__defineSetter__("properties",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});this.__defineGetter__("guid",function(){return _guid});this.__defineSetter__("guid",function(in_val){console.error(lapi.CONSTANTS.CONSOLE_MSGS.IMMUTABLE)});if(in_pset){_properties=_self._pSetDeepCopy(_self,in_pset);if(in_cb){in_cb(_self)}}else{console.warn("Building PSet of "+in_guid);lapi._embedRPC("ACTIVEAPP.getScene().GetByGUID('"+in_guid+"').PropertySet.flatten({"+"flattenType: Application.CONSTANTS.FLATTEN_PARAMETER_TYPE.VALUE_ID"+"});",function(in_embedRPC_message){if(!(in_embedRPC_message.error==="EXECERR")){var pSet=in_embedRPC_message.data;_properties=_self._pSetDeepCopy(_self,pSet);if(in_cb){in_cb(_self)}}})}};lapi.SceneObject.prototype={constructor:lapi.SceneObject,getMaterial:function(){var matGuid=this.properties.getProperty("Materials").getParameter("tmaterial").value;return lapi.getActiveScene().getObjectByGuid(matGuid)},getProperty:function(in_propName){return this.properties.getProperty(in_propName)},bindProperty:function(in_propName,callback){var eventName=this.guid+":"+in_propName;var initialBind=false;if(!lapi._eventCbMap[eventName]){initialBind=true;var cb;var property=this.getProperty(in_propName);if(property){var setPropertyValues=function(prop,data){for(var i in data){var param=prop.getParameter(i);if(param){param._setValueMuted(data[i].value)}else{var innerProp=prop.getProperty(i);if(innerProp){setPropertyValues(innerProp,data[i])}}}};cb=function(data){setPropertyValues(property,data)}}else{property=this.properties.getParameter(in_propName);cb=function(data){property._setValueMuted(data.value)}}lapi._eventCbMap[eventName]=[cb]}if(callback){lapi._eventCbMap[eventName].push(callback)}if(initialBind){lapi._messageIframe({channel:"embedrpc",id:eventName})}},unbindProperty:function(in_propName){var eventName=this.guid+":"+in_propName;if(!lapi._eventCbMap[eventName]){return}delete lapi._eventCbMap[eventName];lapi._messageIframe({channel:"embedrpc",id:eventName,unbind:true})},unbindPropertyCb:function(in_propName,callback){var eventName=this.guid+":"+in_propName;if(!lapi._eventCbMap[eventName]){return}var index=lapi._eventCbMap[eventName].indexOf(callback);if(index>-1){lapi._eventCbMap[eventName].splice(index,1)}},_pSetDeepCopy:function(in_ctxtObject,in_pset){var rtn=new lapi.Property("PropertySet");var diveIn=function(in_prop,in_rtn){for(var i in in_prop){if(in_prop[i].id&&in_prop[i].type){in_rtn.addParameter(new lapi.Parameter(in_ctxtObject,in_rtn,in_prop[i]))}else{var newProp=new lapi.Property(i);in_rtn.appendProperty(newProp);diveIn(in_prop[i],newProp)}}};diveIn(in_pset,rtn);return rtn},computeTransformedAABB:function(in_cb){var bb=this.properties.getProperty("BoundingBoxMin");if(!bb){console.warn("object has no bounding box");return}lapi._embedRPC("var obj = ACTIVEAPP.getScene().GetByGUID('"+this.guid+"');"+"var bbox = ACTIVEAPP.boundingBoxForEntity(obj);"+"bbox.transformAndAxisAlign(obj.matrix);",function(in_response){in_cb(in_response.data)})},fetchChildren:function(in_cb){lapi._embedRPC("var obj = ACTIVEAPP.getScene().GetByGUID('"+this.guid+"');"+"var arr = [];"+"if (obj._children) { "+" for (var i = 0 ; i < obj._children.length; ++i) {"+"  arr[i] = obj._children[i].guid; "+"}"+"}"+"arr",function(in_response){in_cb(in_response.data)})},translate:function(in_axis,in_distance){var axis=in_axis.toUpperCase();lapi._embedRPC("var mesh  = ACTIVEAPP.getScene().GetByGUID('"+this.guid+"');"+"mesh.translate"+axis+"("+in_distance+");"+"var prop = mesh.PropertySet.getProperty('Position');"+"var newPos = {x: mesh.position.x, y : mesh.position.y , z : mesh.position.z};"+"mesh.position.x = 0; mesh.position.y = 0; mesh.position.z = 0;"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : mesh, list : "+"[{parameter : prop.getParameter('x'), value : newPos.x}"+",{parameter : prop.getParameter('y'), value : newPos.y}"+",{parameter : prop.getParameter('z'), value : newPos.z}]}"+", mutebackend : mesh.local, forcedirty : true });")},setImage:function(in_property,in_path,in_imgType){var self=this;lapi._embedRPC("var obj  = ACTIVEAPP.getScene().GetByGUID('"+this.guid+"');"+"var prop = obj.PropertySet.getProperty('"+in_property+"');"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : obj, list : "+"[{parameter : prop.getParameter('imgType'), value : '"+in_imgType+"'}"+",{parameter : prop.getParameter('path'), value : '"+in_path+"'}]}"+", mutebackend : obj.local, forcedirty : true });",function(e){var prop=self.getProperty(in_property);prop.parameters.imgType._setValueMuted(in_imgType);prop.parameters.path._setValueMuted(in_guid)})},setTexture:function(in_property,in_guid,in_imgType){var self=this;lapi._embedRPC("var obj  = ACTIVEAPP.getScene().GetByGUID('"+this.guid+"');"+"var prop = obj.PropertySet.getProperty('"+in_property+"');"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : obj, list : "+"[{parameter : prop.getParameter('imgtype'), value : '"+in_imgType+"'}"+",{parameter : prop.getParameter('texture'), value : '"+in_guid+"'}]}"+", mutebackend : obj.local, forcedirty : true });",function(e){var prop=self.getProperty(in_property);prop.parameters.imgtype._setValueMuted(in_imgType);prop.parameters.texture._setValueMuted(in_guid)})}};lapi.utils={objToArray:function(in_Obj){var rtn=[];for(var i in in_Obj){rtn.push(in_Obj[i])}return rtn},rgbToHEX:function(r,g,b){var hex=[r.toString(16),g.toString(16),b.toString(16)];$.each(hex,function(nr,val){if(val.length===1){hex[nr]="0"+val}});return hex.join("").toUpperCase()},hexToRGB:function(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}};lapi.Scene=function(in_sceneGuid,in_guidList,in_cb){this._guid=in_sceneGuid;this._classedItems={};this._guidItems={};this._objectCount=0;var that=this;for(var i in in_guidList){var tmpGuid;var classID=in_guidList[i];var initClass=this._classedItems[i]={};for(var j in classID){tmpGuid=classID[j];this._guidItems[tmpGuid]=initClass[tmpGuid]=new lapi.SceneObject(tmpGuid,null,function(){++that._objectCount;if(that._objectCount===Object.keys(that._guidItems).length){in_cb()}})}}};lapi.Scene.prototype={constructor:lapi.Scene,getObjectByGuid:function(in_guid){return this._guidItems[in_guid]},getObjectByName:function(in_name){var find=[];var sceneObjs=this._guidItems;var o;for(var i in sceneObjs){o=sceneObjs[i];if(in_name===o.properties.getParameter("name").value){find.push(o)}}return find},getLights:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.LIGHT])},getCameras:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.CAMERA])},getMeshes:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.MESH])},getMaterials:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.MATERIAL])},getTextures:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.TEXTURE])},getGroups:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.GROUP])},getStates:function(){return lapi.utils.objToArray(this._classedItems[lapi.CONSTANTS.SCENE.STATES])},getObjectCount:function(){return this._objectCount},addAssets:function(in_assetArray,in_cb){lapi._loadAssets(in_assetArray,in_cb)},addObject:function(in_tuid,in_guid,in_pset,in_cb){var initClass=this._classedItems[in_tuid];in_pset=in_pset||null;if(!initClass){initClass=this._classedItems[in_tuid]={}}this._guidItems[in_guid]=initClass[in_guid]=new lapi.SceneObject(in_guid,in_pset,in_cb);++this._objectCount},duplicateObject:function(in_sceneObject,in_cb){var self=this;var tuid=in_sceneObject.properties.getParameter("tuid").value;if(tuid==="SceneStateID"||tuid==="CameraID"){console.warn("Cannot duplicate states or cameras.");return}var guid=in_sceneObject.properties.getParameter("guid").value;var name=[in_sceneObject.properties.getParameter("name").value,"Copy ",String(in_sceneObject._copiedCount++)].join(" ");var newGuid=lapi._generateGUID();var self=this;if(in_cb){lapi._cbmap[newGuid]=in_cb}lapi._embedRPC("var pset = ACTIVEAPP.getScene().GetByGUID('"+guid+"').PropertySet.flatten({"+"flattenType: Application.CONSTANTS.FLATTEN_PARAMETER_TYPE.VALUE_ONLY"+"});"+"pset.guid.value = '"+newGuid+"';"+"pset.name.value = '"+name+"';"+"var obj  = [{tuid : pset.tuid.value , pset : pset}];"+" ACTIVEAPP.RunCommand({"+"command : 'InsertObjects',"+"data : obj"+" });")},addNewMaterial:function(in_materialType,in_cb){var self=this;lapi._embedRPC("var mat = ACTIVEAPP.AddEngineMaterial({minortype : '"+in_materialType+"'});"+"mat.guid;",function(in_response){if(in_cb){var scn=lapi.getActiveScene();in_cb(scn.getObjectByGuid(in_response.data))}})},addNewLight:function(in_lightType,in_cb){var self=this;lapi._embedRPC("var light = ACTIVEAPP.AddLight({minortype : '"+in_lightType+"'});"+"light.guid;",function(in_response){if(in_cb){var scn=lapi.getActiveScene();in_cb(scn.getObjectByGuid(in_response.data))}})},setActiveSceneState:function(in_state,in_cb){lapi._embedRPC("ACTIVEAPP.sceneStateManager.activateState('"+in_state.guid+"');",function(e){if(!e.error){in_cb()}else{console.log("There was an error. Could not change scene state.")}})},orbitPitch:function(in_degrees){var pitch=in_degrees/180*Math.PI;lapi._embedRPC("var cam = ACTIVEAPP.GetCamera();"+"var prop = cam.PropertySet.getProperty('Position');"+"var pitch = ("+in_degrees+"/ 180) * Math.PI;"+"var position = Application.Math.safeOrbit({"+"up: cam.up,"+"center: cam.target.position,"+"position: cam.position,"+"yawDelta: 0,"+"pitchDelta: "+pitch+","+"});"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : cam"+", list : [{ parameter : prop.getParameter('x'), value : position.x }"+", { parameter : prop.getParameter('y'), value : position.y }"+", { parameter : prop.getParameter('z'), value : position.z }]}"+", mutebackend : cam.local"+", forcedirty : true });")},orbitYaw:function(in_degrees){var yaw=in_degrees/360*2*Math.PI;lapi._embedRPC("var cam = ACTIVEAPP.GetCamera();"+"var prop = cam.PropertySet.getProperty('Position');"+"var position = Application.Math.safeOrbit({"+"up: cam.up,"+"center: cam.target.position,"+"position: cam.position,"+"yawDelta:"+yaw+","+"pitchDelta: 0"+"});"+"ACTIVEAPP.RunCommand({ command : 'SetParameterValues'"+", data : {ctxt : cam"+", list : [{ parameter : prop.getParameter('x'), value : position.x }"+", { parameter : prop.getParameter('y'), value : position.y }"+", { parameter : prop.getParameter('z'), value : position.z }]}"+", mutebackend : cam.local"+", forcedirty : true });")}};