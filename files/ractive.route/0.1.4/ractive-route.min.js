/*!
 * ractive-route 0.1.4
 * https://github.com/MartinKolarik/ractive-route/
 *
 * Copyright (c) 2014 Martin KolÃ¡rik
 * martin@kolarik.sk
 * https://kolarik.me
 *
 * Licensed under the MIT license
 * http://www.opensource.org/licenses/MIT
 */
!function(a){"undefined"!=typeof module&&module.exports?module.exports=a(require("ractive")):"function"==typeof define&&define.amd?define(["ractive"],a):a(window.Ractive)}(function(a){function b(a,b,f,h){this.pattern=a,this.map=d(a),this.regExp=e(a),this.strictRegExp=g(a),this.isComponent=!!b.extend,this.Handler=this.isComponent?c(b):b,this.observe=j({qs:[],hash:[],state:[]},f),this.allObserved=this.observe.qs.concat(this.observe.hash,this.observe.state),this.router=h||{},this.view=null}function c(a){return a.extend({init:function(a){a.data&&this.set(a.data),this._super&&this._super()}})}function d(a){return(a.match(/\/:\w+/g)||[]).map(function(a){return a.substr(2)})}function e(a){return new RegExp(f(a).replace(/^\^(\\\/)?/,"^\\/?").replace(/(\\\/)?\$$/,"\\/?$"),"i")}function f(a){return("^"+a+"$").replace(/\/:\w+(\([^)]+\))?/g,"(?:/([^/]+)$1)").replace(/\(\?:\/\(\[\^\/]\+\)\(/,"(?:/(").replace(/\//g,"\\/")}function g(a){return new RegExp(f(a))}function h(a){this.basePath=a.basePath||"",this.el=a.el,this.data=a.data||function(){return{}},this.history=a.history||history,this.strictMode=!!a.strictMode,this.linksWatcher=null,this.stateWatcher=null,this.route=null,this.routes=[],this.uri={}}function i(a,b,c){return a.path!==b.path||a.qs!==b.qs||decodeURIComponent(a.hash)!==decodeURIComponent(b.hash)&&(!c||c.observe.hash.length)}function j(a){for(var b=1,c=arguments.length;c>b;b++)for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&void 0!==arguments[b][d]&&(a[d]=arguments[b][d]);return a}function k(a){return s(a,function(a){return!l(a)})}function l(a){return a&&"object"==typeof a?!Object.keys(a).length:!a}function m(){return Array.prototype.slice.call(arguments).join("/").replace(/\/+/g,"/")}function n(a,b){for(;a&&a.nodeName.toLowerCase()!==b;)a=a.parentNode;return a&&a.nodeName.toLowerCase()===b?a:null}function o(a,b){try{var c=k(JSON.parse(decodeURIComponent(a.substr(2))));return b?s(c,b):c}catch(d){return{}}}function p(a){try{return JSON.parse(a)}catch(b){return a||""}}function q(a){var b=a.match(/^(?:([\w+.-]+):\/\/([^/]+))?([^?#]*)?(\?[^#]*)?(#.*)?/);return{protocol:b[1]||"",host:b[2]||"",path:b[3]||"",qs:b[4]||"",hash:b[5]||""}}function r(a,b){var c=a.indexOf("?"),d={};if(-1!==c)for(var e=a.substr(c+1).split("&"),f=[],g=0,h=e.length;h>g;g++)f=e[g].split("="),l(f[1])||l(p(f[1]))||(d[decodeURIComponent(f[0])]=p(decodeURIComponent(f[1])));return b?s(d,b):d}function s(a,b){var c={};if("function"==typeof b)for(var d in a)a.hasOwnProperty(d)&&b(a[d],d)&&(c[d]=a[d]);else for(var e=0,f=b.length;f>e;e++)c[b[e]]=a[b[e]];return c}function t(a){var b=document.getElementById(a);b?window.scrollBy(0,b.getBoundingClientRect().top):window.scrollTo(0,0)}function u(a){return a&&"object"==typeof a?JSON.stringify(a):a}function v(a){return a=k(a),l(a)?"":"#!"+encodeURIComponent(u(a))}function w(a){var b="";for(var c in a)a.hasOwnProperty(c)&&!l(a[c])&&(b+="&"+encodeURIComponent(c)+"="+encodeURIComponent(u(a[c])));return b?"?"+b.substr(1):""}return b.prototype.destroy=function(){return this.view&&(this.view.teardown(),this.view=null),this},b.prototype.getState=function(){for(var a={},b=0,c=this.allObserved.length;c>b;b++)a[this.allObserved[b]]=this.view.get(this.allObserved[b]);return{qs:s(a,this.observe.qs),hash:s(a,this.observe.hash),state:s(a,this.observe.state)}},b.prototype.init=function(a,b){var c=this;return j(b,this.parsePath(a.path),r(a.qs,this.observe.qs),o(a.hash,this.observe.hash)),this.isComponent?(this.view=new this.Handler({el:this.router.el,data:b}),this.allObserved.length&&this.view.observe(this.allObserved.join(" "),function(){c.updating||c.router.update()},{init:!1}),this.view.set("__ready",!0)):this.Handler({el:this.router.el,data:b,uri:this.router.uri}),this},b.prototype.match=function(a,b){return b?this.strictRegExp.test(a):this.regExp.test(a)},b.prototype.parsePath=function(a){for(var b=a.match(this.regExp),c={},d=0,e=this.map.length;e>d;d++)l(b[d+1])||(c[this.map[d]]=p(b[d+1]));return c},h.prototype.addRoute=function(a,c,d){return this.routes.push(new b(a,c,d,this)),this},h.prototype.buildHash=function(a){var b=this.route.getState().hash;return l(b)&&a?a:v(b)},h.prototype.buildQS=function(a){return w(j.apply(null,[{}].concat(a,this.route.getState().qs)))},h.prototype.dispatch=function(a,b){b=b||{};var c=q(a),d=this.match(c.path),e=this.uri;if(!d)return this.redirect(a);if(b.reload||i(this.uri,c,d)){var f="function"==typeof this.data?this.data():this.data,g=j(f,b.state,b.hash,b.qs);this.route&&this.route.destroy(),this.uri=c,this.route=d.init(c,g)}return t(c.hash.substr(1)),this.update(!e.path||e.path!==c.path,!b.noHistory,c)},h.prototype.getUri=function(){return location.pathname.substr(this.basePath.length)+location.search+location.hash},h.prototype.init=function(a){return this.dispatch(this.getUri(),j({noHistory:!0},a))},h.prototype.match=function(a){for(var b=-1;this.routes[++b];)if(this.routes[b].match(a))return this.routes[b];return null},h.prototype.redirect=function(a){return location.pathname=m(this.basePath,a),this},h.prototype.unwatchLinks=function(){return this.linksWatcher&&(document.body.removeEventListener("click",this.linksWatcher),this.linksWatcher=null),this},h.prototype.unwatchState=function(){return this.stateWatcher&&(window.removeEventListener("popstate",this.stateWatcher),this.stateWatcher=null),this},h.prototype.update=function(a,b,c){if(!this.route)return this;c=c||{qs:"",hash:""};var d=m(this.basePath,this.uri.path),e=this.buildQS([r(c.qs)].concat(a?[]:[r(location.search)])),f=this.buildHash(c.hash),g=d+e+f,h=location.pathname+location.search+location.hash,i=this.route.getState().state;return this.uri.qs=e,this.uri.hash=f,b===!0?this.history.pushState(i,null,g):b===!1?this.history.replaceState(i,null,g):g!==h&&this.history.pushState(i,null,g),this},h.prototype.watchLinks=function(a){a=a||new RegExp("^((https?:)?\\/\\/"+location.hostname.replace(/\./g,"\\.")+".*|((?!\\/\\/)[^:]+))$");var b=this;return document.body.addEventListener("click",this.unwatchLinks().linksWatcher=function(c){var d=n(c.target,"a");if(d){var e=d.getAttribute("href")||d.getAttribute("data-href");e&&!d.classList.contains("router-ignore")&&a.test(e)&&(b.dispatch(e),c.preventDefault())}}),this},h.prototype.watchState=function(){var a=this;return window.addEventListener("popstate",this.unwatchState().stateWatcher=function(b){b.state&&a.init({state:b.state})}),this},h.Route=b,a.Router=h});
//# sourceMappingURL=ractive-route.min.map